{
  "filename": "use-nacos-with-coredns.md",
  "__html": "<h1>Nacos DNS user guide</h1>\n<p>This plugin provides a DNS-F client based on CoreDNS, which can help export those registed services on Nacos as DNS domain. DNS-F client is a dedicated agent process(side car) beside the application's process to foward the service discovery DNS domain query request to Nacos.</p>\n<h2>Quick Start</h2>\n<p>To build and run nacos coredns plugin, the OS must be Linux or Mac. And also, make sure your nacos version is 2.2 or higher and golang version is 1.17 or higher. And golang environments(GOPATH,GOROOT,GOHOME) must be configured correctly. Because it needs to support the gRPC connection feature of the nacos2.x version and the go mod function.</p>\n<h2>Build</h2>\n<pre><code>git clone https://github.com/nacos-group/nacos-coredns-plugin.git \ncp nacos-coredns-plugin/bin/build.sh ~/\ncd ~/\nsh build.sh\n</code></pre>\n<h2>Configuration</h2>\n<p>To run nacos coredns plugin, you need a configuration file. A possible file may be as bellow:</p>\n<pre><code>. {\n    log\n    nacos {\n    nacos_namespaceId public\n    nacos_server_host 127.0.0.1:8848\n    }\n    forward . /etc/resolv.conf\n}\n</code></pre>\n<ul>\n<li>forward: domain names those not registered in nacos will be forwarded to upstream.</li>\n<li>nacos_namespaceId: nacos namespaceId, defalut is public.</li>\n<li>nacos_server_host: Ip and Port of nacos server, seperated by comma if there are two or more nacos servers</li>\n</ul>\n<h2>Run</h2>\n<ol>\n<li>Firstly, you need to deploy nacos server.  <a href=\"https://github.com/alibaba/nacos\">Here</a></li>\n<li>Secondly, register service on nacos.</li>\n<li>Finally, configure the file  <strong>(<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>p</mi><mi>a</mi><mi>t</mi><msub><mi>h</mi><mi>t</mi></msub><msub><mi>o</mi><mi>c</mi></msub><mi>o</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>l</mi><mi>e</mi><mo>)</mo><mo>∗</mo><mo>∗</mo><mi>a</mi><mi>n</mi><mi>d</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi><mo>∗</mo><mo>∗</mo><mo>(</mo></mrow><annotation encoding=\"application/x-tex\">path_to_corefile)**  and the port  **(</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">p</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">t</span><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">t</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord\"><span class=\"mord mathit\">o</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">c</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathit\">o</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathit\">i</span><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">e</span><span class=\"mclose\">)</span><span class=\"mbin\">∗</span><span class=\"mord\">∗</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">n</span><span class=\"mord mathit\">d</span><span class=\"mord mathit\">t</span><span class=\"mord mathit\">h</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\">p</span><span class=\"mord mathit\">o</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathit\">t</span><span class=\"mbin\">∗</span><span class=\"mord\">∗</span><span class=\"mopen\">(</span></span></span></span>dns_port)</strong>  to run the plugin.</li>\n</ol>\n<pre><code>$GOPATH/src/coredns/coredns  -conf $path_to_corefile  -dns.port $dns_port \n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/29425667/1663504581023-95437fee-0e3d-4b6a-851c-44a352dedd81.png\" alt=\"\"></p>\n<h2>Test</h2>\n<p>Input the service name  <strong>(<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>n</mi><mi>a</mi><mi>c</mi><mi>o</mi><msub><mi>s</mi><mi>s</mi></msub><mi>e</mi><mi>r</mi><mi>v</mi><mi>i</mi><mi>c</mi><msub><mi>e</mi><mi>n</mi></msub><mi>a</mi><mi>m</mi><mi>e</mi><mo>)</mo><mo>∗</mo><mo>∗</mo><mo separator=\"true\">,</mo><mi>a</mi><mi>n</mi><mi>d</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>p</mi><mi>l</mi><mi>u</mi><mi>g</mi><mi>i</mi><msup><mi>n</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup><mi>s</mi><mi>I</mi><mi>P</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>s</mi><mo>∗</mo><mo>∗</mo><mo>(</mo></mrow><annotation encoding=\"application/x-tex\">nacos_service_name)**  , and the plugin&#x27;s IP address  **(</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.751892em;\"></span><span class=\"strut bottom\" style=\"height:1.001892em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">n</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">c</span><span class=\"mord mathit\">o</span><span class=\"mord\"><span class=\"mord mathit\">s</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">s</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathit\">e</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathit\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathit\">i</span><span class=\"mord mathit\">c</span><span class=\"mord\"><span class=\"mord mathit\">e</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">n</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">m</span><span class=\"mord mathit\">e</span><span class=\"mclose\">)</span><span class=\"mbin\">∗</span><span class=\"mord\">∗</span><span class=\"mpunct\">,</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">n</span><span class=\"mord mathit\">d</span><span class=\"mord mathit\">t</span><span class=\"mord mathit\">h</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\">p</span><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathit\">i</span><span class=\"mord\"><span class=\"mord mathit\">n</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathit\">s</span><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathit\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">d</span><span class=\"mord mathit\">d</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">s</span><span class=\"mbin\">∗</span><span class=\"mord\">∗</span><span class=\"mopen\">(</span></span></span></span>dns_ip)</strong>  and port  <strong>($dns_port)</strong> . We can get the DNS answer from the plugin.</p>\n<pre><code>dig  $nacos_service_name   @$dns_ip   -p $dns_port \n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/29425667/1663504588231-341b38fe-da55-41eb-a24b-e3752b86faa4.png\" alt=\"\"></p>\n",
  "link": "/en-us/docs/v2/ecology/use-nacos-with-coredns.html",
  "meta": {
    "title": "Nacos push domain with CoreDNS",
    "keywords": "CoreDNS, DNS-F",
    "description": "Nacos push domain with CoreDNS"
  }
}