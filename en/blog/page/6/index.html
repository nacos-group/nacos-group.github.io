<!doctype html>
<html lang="en-US" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Blog | Nacos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nacos.io/en/img/nacos_colorful.png"><meta data-rh="true" name="twitter:image" content="https://nacos.io/en/img/nacos_colorful.png"><meta data-rh="true" property="og:url" content="https://nacos.io/en/blog/page/6"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="Nacos"><meta data-rh="true" property="og:title" content="Blog | Nacos"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"><link data-rh="true" rel="canonical" href="https://nacos.io/en/blog/page/6"><link data-rh="true" rel="alternate" href="https://nacos.io/en/blog/page/6" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://nacos.io/zh-cn/blog/page/6" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://nacos.io/blog/page/6" hreflang="default"><link data-rh="true" rel="alternate" href="https://nacos.io/blog/page/6" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://1QV814950M-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Nacos RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Nacos Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Nacos" href="/en/opensearch.xml">


<meta name="aes-config" content="pid=xux-opensource&amp;user_type=101&amp;uid=&amp;username=&amp;dim10=nacos">
<meta name="referrer" content="no-referrer">
<link rel="stylesheet" href="//dev.g.alicdn.com/mamba/mse-arc-ui/0.0.20/umd/mse-arc-ui.min.css">
<script src="//dev.g.alicdn.com/mamba/mse-arc-ui/0.0.20/umd/mse-arc-ui.min.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-0YDFJ7LX7F" async></script><link rel="stylesheet" href="/en/assets/css/styles.ada177ca.css">
<link rel="preload" href="/en/assets/js/runtime~main.2f81187a.js" as="script">
<link rel="preload" href="/en/assets/js/main.1ba25a89.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>



<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script>
<script src="//hm.baidu.com/hm.js?e3a5cec56ef8619cf9d7c2abebd509e3"></script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/nacos_colorful.png" alt="Nacos Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/nacos_colorful.png" alt="Nacos Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://nacos.io/zh-cn/docs/v2/quickstart/quick-start.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"> </a><a class="navbar__item navbar__link" href="/en/">Home</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="/what-is-nacos" href="/en/docs/v2/what-is-nacos">2.X</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/next/v2/what-is-nacos">User Docs</a></li><li><a class="dropdown__link" href="/en/docs/v2/what-is-nacos">2.X</a></li><li><a class="dropdown__link" href="/en/docs/1.X/v2/what-is-nacos">1.X</a></li></ul></div><a class="navbar__item navbar__link" href="/en/cloud">NACOS CLOUD</a><a href="https://developer.aliyun.com/ebook/36?spm=a2c6h.20345107.ebook-index.18.152c2984fsi5ST" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">E-BOOK-NACOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/blog">BLOG</a><a class="navbar__item navbar__link" href="/en/community">COMMUNITY</a><a href="http://console.nacos.io/nacos/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">DEMO-CONSOLE<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>En</a><ul class="dropdown__menu"><li><a href="/en/blog/page/6" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">En</a></li><li><a href="/zh-cn/blog/page/6" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.1.1-release">2.1.1-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.2.0-release">2.2.0-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.2.1-release">2.2.1-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.2.2-release">2.2.2-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/212-and-220beta-release">212-and-220beta-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/announcement-token-secret-key">announcement-token-secret-key</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/higress">higress</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/iscas2023">iscas2023</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-distro-mechanism">nacos-distro-mechanism</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-reigster-mechanism">nacos-reigster-mechanism</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/springboot-0.2.10">springboot-0.2.10</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/up-to-2w-star">up-to-2w-star</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/xiaomi-scale">xiaomi-scale</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos3.0-is-coming">我们总结了3大使用建议，并首次公开 Nacos3.0 规划图 | Nacos 开源4周年</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/iscas2022">Nacos开源之夏，贡献社区赢取12000奖金</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.1.0-release">Nacos 2.1.0版本发布，支持鉴权及加解密插件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/use-nacos-with-rainbond">Install the HA Nacos cluster in Rainbond with one-click</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/apisix">Apache APISIX Realizes Service Discovery Based on Nacos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.0.3-release">Nacos 2.0.3 Release, continue to improve stability.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/performance-compare">Performance comparison between Nacos 2.0 upgrading or not.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/iscas2021">Nacos ISCAS 2021 start to apply</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.0.1-release">Nacos 2.0.1 + 1.4.2 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/1.4.0-release">Nacos 1.4.0 + Go SDK 1.0.1 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/csharp-0.5.0">v0.5.0 of Nacos-sdk-csharp was released! Capabilities aligned with Java SDK！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-2nd-anniversary">Nacos 两周年献礼，Nacos 1.3.2 + Go SDK 1.0.0发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/feeling-of-ASoC-2019">参与开源，Offer拿到手软 -- 来自一名2019阿里巴巴编程之夏同学的亲述</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos 1.2.0 guide">Nacos 1.2.0权限控制介绍和使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-1.3.0-design">Nacos 1.3.0 new kernel construction process</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/namespace-endpoint-best-practices">Namespace,endpoint 最佳实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/pilot mcp">Pilot MCP协议介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos 1.1.4">Nacos 1.1.4发布，业界率先支持Istio MCP协议</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-confd">Nacos整合Confd，支持nginx配置管理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/eureka2">Eureka 2.0 开源工作宣告停止？别担心，ANS 即将 C位强势出道！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos 1.1.0">Nacos 1.1.0发布，支持灰度配置和地址服务器模块</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-roadmap">Nacos GA后的整体规划</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cmdb">Nacos打通CMDB实现就近访问</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/address-server">阿里巴巴基于 Nacos 实现环境隔离的实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos1.0.0">Nacos 1.0.0 发布，正式大规模生产可用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.9.0">Nacos 0.9.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.9-intro">Nacos 0.9.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/huya-practice">虎牙直播在微服务改造方面的实践和总结</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.8">Nacos 0.8.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/huya-nacos">虎牙直播共建Nacos生态</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/5w1h-where">Nacos 有哪些典型的应用场景？—— 配置管理篇</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/dynamic-route-zuul-nacos">使用Nacos实现Spring Cloud Zuul的动态路由</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.6">Nacos 0.6版本发布，支持Dubbo生态并且支持Docker部署</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.5">Nacos0.5发布，支持DNS-based Service Discovery，JAVA 11</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos">Nacos 0.1.0 版本Review 活动设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cncf">Nacos 进入CNCF landscape</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/5w1h-what">What problems does Nacos help us solve? —— Configuration Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/discovery-console">Nacos服务发现控制台预览</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/chengdu-dubbo">Nacos 计划发布v0.2版本，进一步融合Dubbo和SpringCloud生态</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/consul-k8s">Consul与kubernetes整合公告[翻译]</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/dns-sd">微服务架构中基于DNS的服务注册与发现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-is-coming">支持Dubbo生态发展，阿里巴巴启动新的开源项目 Nacos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/alibaba-configserver">阿里巴巴服务注册中心产品ConfigServer 10年技术发展回顾</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos服务发现控制台预览"><meta itemprop="keywords" content="nacos"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/discovery-console">Nacos服务发现控制台预览</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-10-02T00:00:00.000Z" itemprop="datePublished">October 2, 2018</time> · <!-- -->7 min read</div></header><div class="markdown" itemprop="articleBody"><p>Nacos是阿里巴巴中间件部门最近开源的一款用于服务发现和配置管理的产品。在既0.1版本发布基本功能和0.2版本发布与Spring生态结合的功能后，0.3版本将释放全新的控制台界面。配置管理功能相关的控制台，将会由阿里云商业产品ACM控制台改造而来，而服务发现的控制台界面，则将以首次露面的姿态，开放给开源社区。本文就将服务发现控制台相关的界面UI初版设计公布，欢迎大家参与讨论，希望通过大家的批评和建议，将服务发现控制台这块的功能和界面，设计的更加美观和易用。</p><p>服务发现控制台的主要功能是服务列表的展示和搜索，以及服务配置、集群配置、实例配置的查询和更新。在0.3版本中，主要会有两个页面：服务列表和服务详情。</p><h1>服务列表</h1><p>服务列表页面主要展示已经在Nacos注册的服务列表，以及服务的基本信息，服务的基本信息有：服务的名称、服务下集群的数目、服务下实例的数目、服务的健康程度以及进入服务详情的按钮。同时右上角还有一个支持根据服务名搜索服务的搜索框和搜索按钮。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701093629-9880a456-8a37-4663-bd88-853441dab3f4.png" alt="图1 服务列表页面" class="img_ev3q"></p><h1>服务详情</h1><p>在服务列表页面点击“detail”按钮，就会进入服务详情页面。服务详情页面展示的是一个服务的所有关键信息，包括服务的配置和元数据、集群列表和示例列表，以及一些操作的按钮。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701093629-9880a456-8a37-4663-bd88-853441dab3f4.png" alt="图2 服务详情页面" class="img_ev3q"></p><p>在该页面的上方，是服务的配置和元信息，目前包含服务名、保护阈值、健康检查模式以及元数据metadata。右上方是编辑服务按钮，点击后会有对话框弹出，可以对服务的配置进行编辑。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701150783-fa6d58cf-01f4-430c-a5d0-6278c9590404.png" alt="图2 服务详情页面" class="img_ev3q"></p><p>服务详情的下方，是集群列表和集群下的实例列表。每个集群会显示一个集群名，和相应的查看&amp;更新集群详情按钮。点击该按钮后，会是一个更新集群的对话框。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701200952-f9dcb51e-100e-4501-a3db-d665dfaf7188.png" alt="图4 更新集群（TCP健康检查）" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701223427-284aaf1c-1cd3-412e-9f22-d5baae2cee25.png" alt="图5 更新集群（HTTP健康检查）" class="img_ev3q"></p><p>图4和图5分别展示了对集群更新的两种对话框展示，两者的区别是选择了不同的健康检查方式。TCP健康检查方式可以配置检查的端口；HTTP健康检查方式可以配置检查的端口、检查的路径和HTTP头部信息。同时还可以配置是否采用实例的端口进行健康检查，如果配置为true，则健康检查将使用实例注册的端口进行通信。该对话框还可以编辑集群的元信息。</p><p>每个集群下面都会有实例列表，实例列表将会分页展示该集群下注册的所有实例，展示的信息有IP、端口、权重、是否健康、元信息和对应的编辑及下线按钮。下线按钮点击后，该实例将不会返回给订阅端，无论该实例是否健康。“下线”文本会改成“上线”，用于对应的实例上线操作。点击编辑按钮，则会进入编辑实例对话框。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701250740-ffb38cd0-a15d-4425-a2ca-48c5d0d2698e.png" alt="图6 编辑实例对话框" class="img_ev3q"></p><p>编辑实例对话框，可以编辑的信息有实例的权重、是否上下线和元信息。</p><p>0.3版本的服务发现页面，基本就是这样，欢迎大家的反馈。服务注册客户端也可以编辑服务、集群、实例元信息，这些可能会和控制台的编辑相冲突，目前的机制是，不管是控制台更新和客户端更新，都将被Nacos服务端所接受，这点也欢迎大家给出自己的看法。最后也预祝大家国庆放假愉快！</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 计划发布v0.2版本，进一步融合Dubbo和SpringCloud生态"><meta itemprop="keywords" content="nacos,nacos0.2,alibaba,邢学超,Aliware Open Source,spring cloud"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/chengdu-dubbo">Nacos 计划发布v0.2版本，进一步融合Dubbo和SpringCloud生态</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-09-21T00:00:00.000Z" itemprop="datePublished">September 21, 2018</time> · <!-- -->7 min read</div></header><div class="markdown" itemprop="articleBody"><p>在近期的Aliware Open Source 成都站的活动上，阿里巴巴高级工程师邢学超（于怀）分享了Nacos v0.2的规划和进度，并对Nacos v0.3的控制台进行了预览。Nacos v0.2将进一步融入Duboo和Spring Cloud生态，帮助开发者更好的在微服务场景下使用服务发现和动态配置管理。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1537795153259-cc2c60c2-d7cb-431a-8858-cbd71b1c89e9.png" alt="undefined" class="img_ev3q"> </p><p>嘉宾介绍：邢学超（于怀），Nacos开源项目主要推动者，负责阿里巴巴内部 configserver、skywalker和taokeeper产品的架构和研发，爱好代码、篮球、吉他和摇滚，还记得超哥给盲人小朋友写的那首超温暖的歌么？</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1nacos开源介绍">1. Nacos开源介绍<a href="#1nacos开源介绍" class="hash-link" aria-label="Direct link to 1. Nacos开源介绍" title="Direct link to 1. Nacos开源介绍">​</a></h2><p>Nacos是一个更易于帮助构建云原生应用的动态服务发现、配置和服务管理平台，脱胎于承载整个阿里巴巴集团的软负载产品，并于今年7月对外开源。开源以来，获得了来自社区的积极反馈，star数突破 1k 。</p><p>Nacos旨在将阿里巴巴在建设共享服务体系中使用的服务发现、配置及服务管理平台贡献给开源社区，通过打造Dubbo + Nacos的经典组合进一步释放Dubbo在云原生及Service Mesh时代中，在大规模微服务治理、流量治理、服务集成与服务共享等服务平台能力建设上的威力，同时Nacos关注对主流开源社区，如Spring Cloud和Kubernetes云原生体系的无缝对接与支持。该项目预计在7月中旬开放首个测试预览版本，并计划在0.8版本上，达到生产可用的状态。此外，Nacos支持注册中心和配置中心的分离部署，也关注上云的saas化部署，实现云下到云上的平滑迁移。</p><p>Github项目主页：
<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos</a>
Nacos官网：
<a href="http://nacos.io/" target="_blank" rel="noopener noreferrer">http://nacos.io/</a> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-nacos-v02进度和规划">2. Nacos v0.2进度和规划<a href="#2-nacos-v02进度和规划" class="hash-link" aria-label="Direct link to 2. Nacos v0.2进度和规划" title="Direct link to 2. Nacos v0.2进度和规划">​</a></h2><p>Nacos + Dubbo， 双中心重构，释放威力
Dubbo2.7将对注册中心和配置中心进行重构。注册中心将只用于Endpoint的同步，进一步减轻注册中心的存储压力，提高地址同步效率，同时缓解当前由于URL冗余在大规模推送时造成的Consumer端内存计算压力。配置中心将解决当前配置和地址信息耦合的问题，通过抽象动态配置层，让开发者可以对接微服务场景下更常用的、更专业的配置中心。这使得Nacos和Dubbo的完美融合成为可能，进一步释放Dubbo在服务治理、流量治理、服务运营和管理等方面的威力。</p><p>Nacos + Spring Cloud，多层融入，无缝贴合
Nacos在技术社区已经启动Nacos + Spring Cloud的工程，可无缝支持Spring Cloud，为Spring Cloud用户提供更简便的配置中心和注册中心的解决方案，使用Nacos不用再仅仅为服务和配置就需要在生产上hold住 Eureka，Spring Cloud Config Server，Git，Consul 起码四个开源产品。</p><p>Nacos v0.2，全方位注解，实现平滑迁移
在 Java 生态系统中，以 Spring Boot 和 Spring Cloud 为代表的微服务框架，引入了全新的编程模型，包括：
o	注解驱动（Annotation-Driven）
o	外部化配置（External Configuration）
o	自动装配（Auto-Configure）</p><p>Nacos将在v0.2支持原生Spring、Spring Boot、Spring Cloud中关于服务发现、配置管理的原生配置，适配Spring Boot、Spring Cloud标准，此外Nacos还是支持以下注解。
<img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1537795187129-bf48b9b1-3560-4081-99fc-b9c99497525b.png" alt="undefined" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-nacos-代码演示--v03控制台预览">3. Nacos 代码演示 &amp; v0.3控制台预览<a href="#3-nacos-代码演示--v03控制台预览" class="hash-link" aria-label="Direct link to 3. Nacos 代码演示 &amp; v0.3控制台预览" title="Direct link to 3. Nacos 代码演示 &amp; v0.3控制台预览">​</a></h2><p>在分享中，于怀现场演示了如何快速运行一个Nacos应用、调用Nacos API、如何使用注解来运行Nacos。</p><p>同时，Nacos v0.3加入了控制台的功能，控制台分为两个内容，并会融合在一起：</p><ol><li>服务发现模块，包括服务上下线管理、服务权重、服务打标、服务健康信息和服务元信息的展现;</li><li>配置模块，提供配置列表、监听查询、推送轨迹等功能。</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1537795211701-dc18d18c-99a6-40e0-824f-6519d8f8b434.png" alt="undefined" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-nacos-社区介绍和招募计划">4. Nacos 社区介绍和招募计划<a href="#4-nacos-社区介绍和招募计划" class="hash-link" aria-label="Direct link to 4. Nacos 社区介绍和招募计划" title="Direct link to 4. Nacos 社区介绍和招募计划">​</a></h2><p>Nacos强调社区化的发展与社区的多样性，采取PMC和Committer机制来管理社区，鼓励热情、注重细节、积极参与社区活动、对项目感兴趣的开发者参与到开源项目中来，希望在第一年就吸收至少超过5名来自其它公司的PMC，至少10名的外部Committer，依托于社区将产品做得更好，并计划在19年年初和CNCF基金会或apache基金会沟通捐赠适宜，社区贡献者会随之进入基金会体系。</p><p>画外音：我们准备了40个Nacos限量版纪念品，用于奖励参与“Nacos有奖活动”的开发者。
活动链接：
<a href="https://nacos.io/zh-cn/docs/activity.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/docs/activity.html</a></p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Consul与kubernetes整合公告[翻译]"><meta itemprop="keywords" content="Consul,kubernetes"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/consul-k8s">Consul与kubernetes整合公告[翻译]</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-09-02T00:00:00.000Z" itemprop="datePublished">September 2, 2018</time> · <!-- -->8 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="导读">导读<a href="#导读" class="hash-link" aria-label="Direct link to 导读" title="Direct link to 导读">​</a></h2><blockquote><p>Consul是目前业界比较火的服务发现与配置产品，它率先将服务发现和配置管理等分布式服务当中使用到的基础服务进行整合，对外提供分布式及高可用的服务。Consul目前有开源版本和商业化版本同时演进，这也是国内可以借鉴的一种开源策略。同时，Consul对于新技术趋势的跟进和整合，也是值得我们学习和参考的。</p><p>本文翻译了Consul对于Kubernetes的整合所发布的公告文章（<a href="https://www.hashicorp.com/blog/consul-plus-kubernetes" target="_blank" rel="noopener noreferrer">原文地址</a>）。Consul通过支持Service Mesh，并提供对Kubernetes的无缝支持，与目前最受社区热捧的产品进行绑定，并通过功能预告的形式，来达到对产品宣传效果的最大化。</p><p>与Consul产品对应的，阿里巴巴在近期开源了其服务发现与配置管理产品<a href="https://nacos.io" target="_blank" rel="noopener noreferrer">Nacos</a>。Nacos是阿里巴巴集团内部VIPServer、ConfigServer和Diamond三个支撑双十一的重要中间件产品整合而来。Nacos主要关注产品的极致易用以及与云原生的深度整合，主要支持服务发现、配置管理等功能。很快，Nacos也会与Service Mesh进行整合，同时在集团内部和开源进行发布，利用阿里巴巴丰富的场景和开源社区的力量，将Nacos打造成云原生生态中不可或缺的基础产品。</p></blockquote><p>我们很高兴地宣布HashiCorp Consul与Kubernetes深度整合的多项功能。 这篇文章将分享将在未来几周内发布的一系列初步功能。</p><p>这些功能包括用于在Kubernetes上安装Consul的官方Helm Chart，与Consul自动同步Kubernetes服务（反之亦然），外部Consul Agent自动加入Kubernetes中的集群，用于Connect自动保护pod的注入器，以及对Envoy的支持。</p><p>除了与Kubernetes本地集成之外，这些功能还有助于解决多个Kubernetes集群之间以及Kubernetes服务与非Kubernetes服务交互多项重要跨集群挑战。 我们很高兴与您分享这项工作。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="功能点">功能点<a href="#功能点" class="hash-link" aria-label="Direct link to 功能点" title="Direct link to 功能点">​</a></h2><p>以下是将在未来几周内公布和发布的功能列表。后续公告博客将详细介绍每个项目，每个项目都将链接到该公告帖子。</p><ul><li><strong>Helm Chart</strong>。用于在Kubernetes上安装，配置和升级Consul的官方Helm Chart。此Helm Chart还将支持Kubernetes的其他功能的自动安装和配置，例如目录同步。</li><li><strong>Kubernetes自动加入</strong>。Consul的云自动加入功能将更新，以支持发现和加入基于Kubernetes的Agent代理。这将使外部Consul Agent加入在Kubernetes中运行的Consul集群。</li><li><strong>服务目录同步：从K8S到Consul</strong>。适当的Kubernetes服务将自动同步到Consul目录，使非Kubernetes服务能够发现并连接到Kubernetes中运行的服务。</li><li><strong>服务目录同步：从Consul到K8S</strong>。Consul服务将同步到Kubernetes服务，以便应用程序可以使用Kubernetes本地服务发现来发现和连接在Kubernetes之外运行的服务。</li><li><strong>Connect自动注入</strong>。部署在Kubernetes中的Pod可以配置为自动使用Connect通过TLS进行安全通信。</li><li>支持<strong>Envoy Proxy</strong>。配置为使用Connect自动注入的Pod可以使用Envoy Proxy进行第4层通信，通过Connect进行保护。 Envoy也将用于非Kubernetes的Connect部署。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="与kubernetes整合">与Kubernetes整合<a href="#与kubernetes整合" class="hash-link" aria-label="Direct link to 与Kubernetes整合" title="Direct link to 与Kubernetes整合">​</a></h2><p>我们目前正在与Kubernetes在多个产品上进行密切整合。通过使我们的产品更易于运行以及集成和增强Kubernetes功能，我们看到了解决纯Kubernetes用户挑战的机会。</p><p>这种集成的核心原则是增强现有功能而不是替换。服务、ConfigMaps及Secrets等功能是Kubernetes核心工作流程的一部分。更高级别的工具和扩展利用这些核心原语。因此，我们也在整合和增强这些核心原语。例如，Consul目录同步将Consul目录中的外部服务转换为一级的Kubernetes服务资源。然后，在Kubernetes中运行的应用程序可以发现并连接到非Kubernetes服务。</p><p>除了使我们的产品在Kubernetes中更易用和更自然之外，这些集成还允许用户在与非Kubernetes工作负载共享的环境中更好地工作。 虽然新用户很容易在纯Kubernetes环境中启动，但大多数部署必须与在云计算环境中运行的外部服务，本地数据中心等进行交互。 像Consul这样的HashiCorp产品专为这些异构环境而设计。 通过实现更自然的Kubernetes体验，非Kubernetes应用程序与Kubernetes应用程序交互变得同样自然。</p><h1>下一步</h1><p>我们很高兴地宣布第一批HashiCorp Consul和Kubernetes的功能。 这些功能使得在Kubernetes上运行Consul，与非Kubernetes服务进行交互，在Kubernetes内外进行安全通信等等更加容易。 这些功能中的每一项都将在未来几周内全面公布和发布，从下周的Helm Chart开始。</p><p>Terraform和Vault也与Kubernetes紧密集成。 Terraform Kubernetes提供商现在拥有一名专职工程师，并且在未来几个月内应该会迅速改进。 Vault正在开发新的集成，也将很快公布。</p><p>如果您对Kubernetes，我们的工具以及改进这些集成感兴趣，请加入我们！ 我们有一些针对Kubernetes集成的生态系统工程师岗位需求。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="微服务架构中基于DNS的服务注册与发现"><meta itemprop="keywords" content="微服务,DNS"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/dns-sd">微服务架构中基于DNS的服务注册与发现</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-06-02T00:00:00.000Z" itemprop="datePublished">June 2, 2018</time> · <!-- -->11 min read</div></header><div class="markdown" itemprop="articleBody"><p>当前，微服务架构已经成为企业尤其是互联网企业技术选型的一个重要参考。微服务架构中涉及到很多模块，本文将重点介绍微服务架构的服务注册与发现以及如何基于DNS做服务发现。最后，简单介绍下阿里巴巴内部是如何基于DNS做服务发现的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="服务注册与发现">服务注册与发现<a href="#服务注册与发现" class="hash-link" aria-label="Direct link to 服务注册与发现" title="Direct link to 服务注册与发现">​</a></h2><p>微服务体系中，服务注册与服务发现是两个最核心的模块。服务A调用服务B时，需要通过服务发现模块找到服务B的IP和端口列表，而服务B的实例在启动时需要把提供服务的IP和端口注册到服务注册中心。一个典型的结构如下图：</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/7601/1525185623334-8fbf69bb-00df-4202-a951-c1ee9caace88.png" alt="image.png | left | 733x470" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务注册">服务注册<a href="#服务注册" class="hash-link" aria-label="Direct link to 服务注册" title="Direct link to 服务注册">​</a></h3><p>目前，流行的注册中心比较多，常见的有zookeeper、ectd、consul、eureka等。服务注册通常有三种：自注册、第三方注册、注册中心主动同步。</p><ul><li>自注册
自注册，顾名思义，就是服务提供方在启动服务时自己把提供服务的IP和端口发送到注册中心，并通过心跳方式维持健康状态；服务下线时，自己把相应的数据删除。典型的像使用eureka客户端发布微服务。</li><li>第三方注册
第三方注册是指，存在一个第三方的系统负责在服务启动或停止时向注册中心增加或删除服务数据。典型的用法是devops系统或容器调度系统主动调注册中心接口注册服务；</li><li>注册中心主动同步
与第三方注册方式类似，主动注册方式是指注册中心和调度或发布系统打通，主动同步最新的服务IP列表；一个例子是kubernetes体系中，coredns订阅api server数据。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务发现">服务发现<a href="#服务发现" class="hash-link" aria-label="Direct link to 服务发现" title="Direct link to 服务发现">​</a></h3><p>在真正发起服务调用前，调用方需要从注册中心拿到相应服务可用的IP和端口列表，即服务发现。服务发现从对应用的侵入性上可以分为两大类：</p><ul><li>SDK-Based
这类的服务发现方式，需要调用方依赖相应的SDK，显式调用SDK代码才可以实现服务调用，即对业务有侵入性，典型例子如eureka、zookeeper等。</li><li>DNS-Based
DNS本身是一种域名解析系统，可以满足简单的服务发现场景，如双方约定好端口、序列化协议等等。但是，这远远不能满足真正的微服务场景需求。近几年，基于dns的服务发现渐渐被业界提了出来。后面将重点介绍基于DNS的服务发现及阿里巴巴的实践。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="基于dns的服务发现">基于DNS的服务发现<a href="#基于dns的服务发现" class="hash-link" aria-label="Direct link to 基于DNS的服务发现" title="Direct link to 基于DNS的服务发现">​</a></h2><p>DNS协议是目前最为通用的协议之一，几乎所有操作系统都会有DNS客户端实现。所以，其天然具有跨语言特性。这也是快速接入微服务体系最快的一个方式。要基于DNS做服务发现，首先注册中心的数据应该可以以DNS的数据格式暴露出来。让任何系统的DNS 客户端都可以通过DNS协议获取服务列表。</p><p>基于DNS的服务发现方式，大致可以归结两类：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="独立dns服务器">独立DNS服务器<a href="#独立dns服务器" class="hash-link" aria-label="Direct link to 独立DNS服务器" title="Direct link to 独立DNS服务器">​</a></h3><p>独立DNS Server模式的基本架构如下图：</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/7601/1525185653048-094f815d-47af-409e-ac21-6662e20e76f4.png" alt="image.png | left | 747x469" class="img_ev3q"></p><p>如上图所示，这种架构中，需要独立的DNS服务器。DNS服务器从注册中心获取所有已注册的服务及对应的IP端口列表。调用方Service A 通过DNS查询某个服务下的IP列表，然后发起调用。</p><p>这种类型的服务发现方式优缺点分别如下：</p><ul><li>优点<ul><li>集中的DNS服务器，便于升级维护</li></ul></li><li>缺点<ul><li>对DNS服务器性能要求高</li><li>这种情况下一般需要LVS设备为DNS服务器集群做请求转发，存在单点问题</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dns-filter">DNS Filter<a href="#dns-filter" class="hash-link" aria-label="Direct link to DNS Filter" title="Direct link to DNS Filter">​</a></h3><p>DNS Filter模式我们定义为把DNS服务器集成到服务调用方机器或容器里，如下图所示：</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/7601/1525185676597-acaebac3-2b65-48a3-bdbf-7d27af7f1038.png" alt="image.png | left | 747x469" class="img_ev3q"></p><p>这种模式中，首先要保证ServiceA的DNS查询都被拦截到本机的DNS服务器上（127.0.0.1:53），在获取到服务的IP列表后发起调用。由于这种方式把DNS服务器前置到实际调用的机器上，所以它解决了独立DNS服务器模式的单点问题，完全P2P的模式。但由于需要在应用机器上安装DNS服务器，其维护和升级成本较前者高一些。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="阿里基于dns的服务发现实践">阿里基于DNS的服务发现实践<a href="#阿里基于dns的服务发现实践" class="hash-link" aria-label="Direct link to 阿里基于DNS的服务发现实践" title="Direct link to 阿里基于DNS的服务发现实践">​</a></h3><p>阿里巴巴早在2014年就开始了基于DNS做服务发现的尝试了，现在已经形成了较为成熟的模式。阿里内部以VIPServer作为注册中心，并开发了DNS Filter，部署在应用容器内。目前已经有超过20w个机器或容器上安装了DNS Filter，支持了几乎所有REST服务发现。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="注册中心-vipserver">注册中心 VIPServer<a href="#注册中心-vipserver" class="hash-link" aria-label="Direct link to 注册中心 VIPServer" title="Direct link to 注册中心 VIPServer">​</a></h4><p>VIPServer是阿里中间件软负载团队自研的服务注册中心，按照第一章的分类，VIPServer同时支持三种模式的服务注册，并且均有相当规模的应用。除此之外，VIPServer具备如下特性：</p><ul><li>主动与被动健康检查
VIPServer同时支持主动与被动健康检查。主动健康检查是指VIPserver服务端主动定期发送健康检查探测包，探测服务提供方是否可以正常提供服务。用户可以配置多种健康检查方式，自定义探测端口和探测URL（HTTP）。主动探测的好处在于服务提供方不用做任何改动即可快融入微服务架构。被动健康检查则是指服务提供方主动注册自己的IP、端口和服务名等信息，并通过心跳方式保持活性。</li><li>多种负载均衡策略
同时，VIPServer支持多种负载均衡策略，包括权重、同机房、同地域、同环境等等，是阿里异地多活项目的核心系统之一。后面会有专门的文章介绍如何基于VIPServer实现异地多活，这里不再赘述。</li><li>多重容灾保护策略
VIPServer提供了多种容灾保护策略，可以有效减少人为或者底层系统（网络等）异常带来的影响。这些容灾保护包括：<ul><li>客户端缓存，即使VIPServer服务端挂掉也不影响应用的正常调用；</li><li>服务端保护阈值，有效防止应用因压力过大而发生雪崩；</li><li>客户端容灾目录，提供人工干预服务IP列表的能力；</li><li>客户端空列表保护，有效防止人为误删IP列表操作或VIPServer服务端异常</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dns-f客户端">DNS-F客户端<a href="#dns-f客户端" class="hash-link" aria-label="Direct link to DNS-F客户端" title="Direct link to DNS-F客户端">​</a></h4><p>出于性能的考虑，我们采用了第二种DNS Filter的服务发现模式。为此，我们单独开发了DNS-F客户端，DNS-F客户端跟应用部署在同一个主机或容器内。其工作原理如下图所示：</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/7601/1525185700084-16f2c073-0c2b-49c0-b85b-ce2ca1163326.png" alt="image.png | left | 716x392" class="img_ev3q"></p><ul><li>首先，应用ServiceA通过DNS查询获取到ServiceB的可用IP列表</li><li>DNS-F会拦截到ServiceA的查询请求，判断自己是否该查询的答案，如果有（服务已在VIPServer中注册）则直接返回IP列表；</li><li>如果查询的服务在VIPServer中没有注册，DNS-F把DNS查询转发给系统的nameserver，由真正的DNS系统解析；</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2><p>本文介绍了微服务架构中如何基于DNS做服务发现。首先，介绍了服务法注册与发现的概念、服务注册与发现的几种方式及其优缺点；然后，介绍基于DNS的服务发现的两种方式及其优缺点；最后，介绍了阿里巴巴基于DNS做服务发现的实践，主要是基于自研的软负载系统VIPServer。基于DNS的服务发现要解决的问题远不止本文描述的这些，敬请期待后续系列文章（：。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="支持Dubbo生态发展，阿里巴巴启动新的开源项目 Nacos"><meta itemprop="keywords" content="nacos,alibaba,dubbo"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/nacos-is-coming">支持Dubbo生态发展，阿里巴巴启动新的开源项目 Nacos</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-06-01T00:00:00.000Z" itemprop="datePublished">June 1, 2018</time> · <!-- -->18 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="贡献dubbo生态阿里nacos开源计划">贡献Dubbo生态，阿里Nacos开源计划<a href="#贡献dubbo生态阿里nacos开源计划" class="hash-link" aria-label="Direct link to 贡献Dubbo生态，阿里Nacos开源计划" title="Direct link to 贡献Dubbo生态，阿里Nacos开源计划">​</a></h2><p>在上周六的Aliware技术行上海站Dubbo开发者沙龙上，阿里巴巴高级技术专家郭平(坤宇)宣布了阿里巴巴的一个新开源计划，阿里巴巴计划在7月份开启一个名叫Nacos的新开源项目, 在活动演讲中，坤宇介绍了这个开源项目的初衷，他表示 “将通过Nacos项目将阿里巴巴在建设共享服务体系中使用的服务发现、配置及服务管理平台贡献给开源社区，通过打造Dubbo + Nacos的经典组合进一步释放Dubbo在云原生及Service Mesh时代中，在大规模微服务治理、流量治理、服务集成与服务共享等服务平台能力建设上的威力，同时Nacos会非常关注对主流开源社区，如Spring Cloud和Kubernetes云原生体系的无缝对接与支持”。该项目预计在7月中旬之前开放首个测试预览版本，并计划在未来6~8个月release的0.8版本开始达到生产可用的状态。</p><p>活动的 <a href="http://www.itdks.com/dakashuo/playback/2307" target="_blank" rel="noopener noreferrer">视频回放</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-nacos-nɑkəʊs">什么是 Nacos /nɑ:kəʊs/?<a href="#什么是-nacos-nɑkəʊs" class="hash-link" aria-label="Direct link to 什么是 Nacos /nɑ:kəʊs/?" title="Direct link to 什么是 Nacos /nɑ:kəʊs/?">​</a></h2><p>Nacos 是阿里巴巴的新开源项目，其核心定位是 “一个更易于帮助构建云原生应用的动态服务发现、配置和服务管理平台”。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530083408486-b4698533-8e69-4e0a-9f3a-fdb1cdfbd290.png" alt="Screen Shot 2018-06-27 at 15.09.35.png" class="img_ev3q"> </p><p>Nacos 有三大主要功能:</p><ul><li>服务发现与服务管理</li></ul><p>在采用以“服务(Service)”为中心的诸如微服务及云原生方式的现代应用架构时，动态服务发现至关重要。 Nacos同时支持基于DNS和基于RPC（如Dubbo/gRPC）的服务发现，并为您提供服务的实时的健康检查以防止将请求发送给不健康的主机，基于Nacos您也可以更方便的实现服务断路器。Nacos提供的强大的服务的元数据管理，路由及流量管理策略也能够帮助您更好的构建更强壮的微服务平台。</p><ul><li>动态配置管理</li></ul><p>动态配置服务允许您在所有环境中以集中和动态的方式管理所有应用程序或服务的配置。动态配置消除了配置更新时重新部署应用程序和服务的需要。可以更方便的帮助您实现无状态服务，更轻松地实现按需弹性扩展服务实例。</p><ul><li>动态DNS服务</li></ul><p>支持权重路由的动态DNS服务使您可以更轻松地在数据中心内的生产环境中实施中间层负载平衡，灵活的路由策略，流量控制和简单的DNS解析服务，帮助您更容易的实现DNS-based服务发现。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么开源-nacos">为什么开源 Nacos<a href="#为什么开源-nacos" class="hash-link" aria-label="Direct link to 为什么开源 Nacos" title="Direct link to 为什么开源 Nacos">​</a></h2><p>阿里巴巴为什么选择这么一个时间点开源Nacos，其背后的思考是什么，坤宇也给出了详细的解读，在演讲中，坤宇表示主意基于以下几点:</p><ul><li><strong>围绕着Service为中心的分布式基础设施正在变的越来越重要</strong></li></ul><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077340492-513a25c0-51d0-494f-b39d-6f615d7e3915.png" alt="Screen Shot 2018-06-27 at 13.28.09.png" class="img_ev3q"> </p><p>世界正在变的更快，创新和市场竞争的节奏正在变得愈发剧烈，如何超快速实现业务增长成为商业竞争的主旋律，几乎一夜之间共享单车就火遍全国，不到几年滴滴就改变了我们的打车方式，腾讯三班倒实现全民“吃鸡”，现在企业估值在从0到100亿所需的时间越来越短，而企业的平均寿命从标普的数据来看却从上世纪60年代的60年下降到了今天的15年，一切都表示创新和竞争的速度和烈度在加强。</p><p>另一方面技术基础设施的敏捷和有效性在商业成功的要素上占据的比重越来越大，云计算在资源和服务交付模式上的变革，带来了效率的革命性提升，带来了更敏捷的基础设施（创业不用再买机器并找机房托管，从以前的半年准备周期到现在在云上的小时级创建全套服务），而在应用架构层面，微服务架构模式带来的灵活性、韧劲，快速组合和聚合原子服务从而创新，给业务快速创新和试错提供了条件，已经被越来越多的应用平台证明其有效性，技术基础设施的更敏捷，给商业的敏捷和商业的竞争优势提供了基础。</p><p>在今天，无论是云计算，微服务还是围绕Kubernetes为中心的云原生，都在强调以“服务”为内核的应用架构模式，如果说15年前我们在讨论“一切皆是对象”构建单体系统，那么今天我们就是在谈论“一切皆是服务”，10年前淘宝服务化改造顺应了这种趋势，8年前微服务架构思想也顺应了这个趋势，今天面向“服务”的各种分布式基础设施正在变得越来越重要，站在阿里巴巴10年的服务化发展经验上看，在大规模服务发现和服务治理和服务共享领域现有的开源解决方案是不是都已经非常完美了呢？根据阿里巴巴服务化走过的这些年的生产经验来看，我们觉得并没有。</p><ul><li><strong>阿里巴巴在 &quot;共享服务体系&quot; 建设上的经验可以在各个行业大规模复用</strong></li></ul><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077414293-3d22cd01-6e3c-49d1-82ea-ad2f8d443cf9.png" alt="Screen Shot 2018-06-27 at 13.29.52.png" class="img_ev3q"> </p><p>阿里巴巴中台理念和体系，与云原生在精神的“道”上完全契合，即“厚技术平台，薄应用” 支持业务的快速创新与试错，从而赢得市场，中台体系倡导双引擎架构，略过“大数据”不谈，但看业务中台，就是一个大的以“服务”为中心的共享服务平台，在线服务沉淀业务数据，同步到大数据平台计算和挖掘，大数据平台则通过数据回馈，指导业务及服务的创新，支成可沉淀和可共享“服务”体系的服务注册与服务治理平台是这个体系的关键要素之一。</p><ul><li><strong>“服务治理，服务沉淀、服务共享和服务的可持续发展”是“共享服务体系”的核心价值主张</strong></li></ul><p>支持创新从小苗长成参天大树，服务平台不断演进，这一切需要一个强大的服务平台和服务基础设施的支撑。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077444757-d36f344d-d3ae-4df0-808f-8500b4320e8d.png" alt="Screen Shot 2018-06-27 at 13.30.25.png" class="img_ev3q"> </p><ul><li><strong>阿里巴巴将通过Dubbo + Nacos以及一系列开源项目打造服务发现、服务及流量管理、服务共享平台</strong></li></ul><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077476468-4ce30dd9-0da7-414a-875d-acc151739c1d.png" alt="Screen Shot 2018-06-27 at 13.30.58.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-与-主流开源生态的关系">Nacos 与 主流开源生态的关系<a href="#nacos-与-主流开源生态的关系" class="hash-link" aria-label="Direct link to Nacos 与 主流开源生态的关系" title="Direct link to Nacos 与 主流开源生态的关系">​</a></h2><p>Nacos 不会是个封闭的体系，除了对于阿里开源生态体系如Dubbo等自身的支持，也非常强调融入其它的开源生态，这里就包括Java的微服务生态体系Spring Cloud，Kubernetes/CNCF云原生生态体系，正如Nacos的未来全景图展示的那样</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077509217-d4fec359-8a41-4c51-a986-c44e06d16950.png" alt="Screen Shot 2018-06-27 at 13.31.30.png" class="img_ev3q"> </p><ul><li>Dubbo + Nacos， 专为Dubbo而生的注册中心与配置中心</li></ul><p>在阿里巴巴生产环境上，Dubbo和Nacos天然就是长在一起的，因为Nacos的缺失，传统的注册中心解决方案让Dubbo在服务治理、流量治理、服务运营和管理等方面的威力被限制和削弱了，Nacos的开源和开放会在采用Dubbo的用户环境中释放这些威力</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077613925-04d767fd-ec95-4fe2-8249-ce8650fbe372.png" alt="Screen Shot 2018-06-27 at 13.31.57.png" class="img_ev3q"> </p><ul><li>Nacos 会完全兼容Spring Cloud</li></ul><p>Nacos会无缝支持Spring Cloud，为Spring Cloud用户其提供更简便的配置中心和注册中心的解决方案，使用Nacos不用再仅仅为服务和配置就需要在生产上hold住 Eureka，Spring Cloud Config Server，Git，RabbitMQ/Kafka 起码四个开源产品。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077646935-7ca8a74d-59e5-4e01-865e-06fd5631e623.png" alt="Screen Shot 2018-06-27 at 13.33.40.png" class="img_ev3q"> </p><ul><li>Nacos 支持Kubernetes DNS-based Service Discovery</li></ul><p>在演讲中坤宇也表示，阿里巴巴这么多年在VIPServer DNS-based Service Discovery上的实践证明，在云原生时代，应用会更关注与基础设施的解耦合、多语言乃至多云的诉求，服务发现的未来一定是基于标准的DNS协议做，而不是像Eureka或者像ZooKeeper这样的私有API或者协议做, 同时在云上，在服务发现场景中，注册中心更关注的是可用性而不是数据一致性，所以Nacos会首推DNS-based Servcie Discovery，并优先关注可用性，而这也正是Nacos可以无缝融合进Kubernetes服务发现体系的原因所在</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077691493-4dae9605-6886-4307-bc9d-16ba1cceb7ac.png" alt="Screen Shot 2018-06-27 at 13.34.18.png" class="img_ev3q"> </p><ul><li>Nacos 会填补Spring Cloud 体系与 Kubernetes 体系的鸿沟
</li></ul><p>未来会有越来越多java生态的用户会选择 Kubernetes+Spring Cloud 组合，但不幸的是，在服务发现和配置管理的解决方案上，这2个体系都采用了完全不同的方案，这给同时采用2个体系的用户在注册中心和配置中心的需求上带来了非常大的不必要的复杂性。Nacos会尝试填补2者的鸿沟，以便在2套体系下可以采用同一套服务发现和配置管理的解决方案，这将大大的简化使用和维护的成本。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077731231-85a58c0e-ff5c-45a1-9bc8-b989e2b09d55.png" alt="Screen Shot 2018-06-27 at 13.35.05.png" class="img_ev3q"> </p><ul><li>Nacos 与 Service Mesh</li></ul><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077754298-39bbbdd0-c7af-434a-b189-8fd7ac958b43.png" alt="Screen Shot 2018-06-27 at 13.35.38.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-部分特性预览">Nacos 部分特性预览<a href="#nacos-部分特性预览" class="hash-link" aria-label="Direct link to Nacos 部分特性预览" title="Direct link to Nacos 部分特性预览">​</a></h2><p>同时在会上，坤宇对Nacos 1.0版本的部分特性给大家做了预览</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077784470-27f0e268-8d1f-443a-b1a5-3d59e15ab8f4.png" alt="Screen Shot 2018-06-27 at 13.36.06.png" class="img_ev3q"> </p><p>每个产品都有自己的风格和标签，坤宇在演讲中表示，团队会通过持续的贡献和努力，希望未来给Nacos贴上四个方面的标签</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077851626-25444089-c027-4b89-a606-2e693b4e052d.png" alt="Screen Shot 2018-06-27 at 13.37.10.png" class="img_ev3q"> </p><p>在部署形态上，Nacos会支持多种部署形态，包括注册中心与配置中心的分离部署，同时在阿里云上提供Nacos的SaaS化部署服务，感兴趣的可以直接在阿里云上开通账户免费体验Nacos服务，在开源与商业化版本差别上，商业化的ACM以及EDAS ANS更强调与阿里云其它云服务以及其它Aliware PaaS的商业产品的集成体验以及提供商业服务。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077875162-26cfa0e2-3da0-473e-98b9-190aa6d6d97a.png" alt="Screen Shot 2018-06-27 at 13.36.37.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-的主要产品里程碑及计划">Nacos 的主要产品里程碑及计划<a href="#nacos-的主要产品里程碑及计划" class="hash-link" aria-label="Direct link to Nacos 的主要产品里程碑及计划" title="Direct link to Nacos 的主要产品里程碑及计划">​</a></h2><blockquote><p>罗马不是一天建成的，吾将上下而求索 </p></blockquote><p>因为Nacos是脱胎于阿里巴巴的生产代码，整体体系非常庞杂，在代码梳理、重构和剥离与内部的耦合上是一个渐进的过程，所以@坤宇特别提醒社区在Nacos 0.8达到生产可用状态前，不建议用于生产，不过可以在开发和测试环境尝试使用，在0.8版本开始，大家可以放心的用于生产环境，Nacos整体研发计划是在未来6-8个月将达到生产可用的状态，未来会很快启动将Nacos贡献给开源基金会进一步社区化发展。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077912860-52c7fea4-5285-45a0-a3b8-73ba010c53da.png" alt="Screen Shot 2018-06-27 at 13.38.13.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-与相关开源产品的对比">Nacos 与相关开源产品的对比<a href="#nacos-与相关开源产品的对比" class="hash-link" aria-label="Direct link to Nacos 与相关开源产品的对比" title="Direct link to Nacos 与相关开源产品的对比">​</a></h2><blockquote><p>君子和而不同</p></blockquote><p>如上面对整体业务及技术形式的判断，我们可以看到 Nacos 与同类竞品的主要不同主要在于理念，@坤宇介绍说，严格来说这些市面上的产品并不与Nacos完全对标，只是与Nacos里面的服务发现部分对标，Nacos的未来更看重在这些产品的基础上构建服务平台的能力，而不仅仅是在基础的服务发现能力上。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077938157-00e6b34f-9a16-498c-9b89-cc48f6d6bb73.png" alt="Screen Shot 2018-06-27 at 13.38.41.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区化发展欢迎加入并贡献社区">社区化发展，欢迎加入并贡献社区<a href="#社区化发展欢迎加入并贡献社区" class="hash-link" aria-label="Direct link to 社区化发展，欢迎加入并贡献社区" title="Direct link to 社区化发展，欢迎加入并贡献社区">​</a></h2><blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><p>与阿里巴巴早期的开源不同，阿里巴巴新一轮的开源包括RocketMQ，Pouch Container，Dubbo, Nacos等开源产品更强调社区化的发展与社区的多样性，鼓励更多的公司和更多的开发者参与到开源项目中来，依托于社区将产品做得更好，同时一开始就会关注国际化，与国外同类产品的直面竞争。</p><p>Nacos初步计划，在第一年就吸收至少超过5名来自其它公司的PMC,至少10名的外部Committer, 而且Nacos处在项目开源的初期，有大把的空间让有想法、有热情、有能力的开发者参与进来，Nacos本身在很多方面都急需要社区的帮助，这里面就急需包括前端及UI建设，Spring Cloud、Kubernetes、Service Mesh体系融合与集成，多语言客户端等各方面的技术领导者的参与，如果您对Nacos这个开源项目感兴趣，欢迎加入Nacos社区。你可以通过扫“超哥”的微信二维码，让“超哥” 帮你加入 “Nacos社区交流群” </p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077965587-8f4e3100-bdd4-469a-9ea0-7af7061bc9ef.png" alt="Screen Shot 2018-06-27 at 13.39.09.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="感谢所有未来给我们帮助的朋友">感谢所有未来给我们帮助的朋友<a href="#感谢所有未来给我们帮助的朋友" class="hash-link" aria-label="Direct link to 感谢所有未来给我们帮助的朋友" title="Direct link to 感谢所有未来给我们帮助的朋友">​</a></h2><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530078016801-65ce72c1-c135-42b6-8076-a046f7829ba7.png" alt="Screen Shot 2018-06-27 at 13.39.40.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ul><li><a href="https://yq.aliyun.com/articles/601745" target="_blank" rel="noopener noreferrer">阿里巴巴为什么不用 ZooKeeper 做服务发现？</a></li><li><a href="https://yq.aliyun.com/articles/226238?spm=5176.163362.847322.3.5a8925397in790" target="_blank" rel="noopener noreferrer">现代应用架构中的配置管理面临的挑战和应对之道</a></li><li><a href="http://jm.taobao.org/2016/06/02/zhangwensong-and-load-balance/" target="_blank" rel="noopener noreferrer">章文嵩博士和他背后的负载均衡帝国</a></li><li><a href="https://blog.csdn.net/heyc861221/article/details/80126013" target="_blank" rel="noopener noreferrer">VIPServer：阿里智能地址映射及环境管理系统详解</a></li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="阿里巴巴服务注册中心产品ConfigServer 10年技术发展回顾"><meta itemprop="keywords" content="nacos,configserver,alibaba"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/alibaba-configserver">阿里巴巴服务注册中心产品ConfigServer 10年技术发展回顾</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-05-20T00:00:00.000Z" itemprop="datePublished">May 20, 2018</time> · <!-- -->22 min read</div></header><div class="markdown" itemprop="articleBody"><p>作者：阿里巴巴高级技术专家，许真恩(慕义)</p><p>文章概要：本文简单描述了Eureka1.0存在的架构问题，Eureka2.0设想的架构。详细回顾了阿里巴巴的服务注册中心ConfigServer产品从2008年建设元年至今经历的关键架构演进。通过这个文章你会对基于AP模式的注册中心在技术发展过程中将会碰到的问题有所感知。</p><h1>Eureka1.0架构存在的问题</h1><p>Eureka作为Netflix公司力推和SpringCloud微服务标配的注册中心开源解决方案，其Eureka 2.0 (Discontinued)的消息在社区引起了不小的骚动；其实早在2015年社区就已经放出了2.0架构的升级设想，但是3年的时间过去，等到的确是Discontinued的消息，虽然2.0的代码在github的主页上也已经放出，但是告诫用户要自行承担当中的使用风险。我想不会有人真的把2.0直接投入到生产中使用。</p><p>对于为什么要做Eureka2.0，其官方的wiki中的Why Eureka 2.0和Eureka 2.0 Improvements做了如下的说明</p><ul><li>Only support homogenous client views: Eureka servers only expects the client to always get the entire registry and does not allow to get specific applications/VIP addresses. This imposes a memory limitation on all clients registering with Eureka, even if they need a very small subset of the Eureka’s registry.</li><li>Only supports scheduled updates: Eureka client follows a poll model to fetch updates from the server routinely. This imposes an overhead on the client of doing a scheduled call to the server, even if there are no changes and also delays the updates by the poll interval.</li><li>Replication algorithm limits scalability: Eureka follows a broadcast replication model i.e. all the servers replicate data and heartbeats to all the peers. This is simple and effective for the data set that eureka contains however replication is implemented by relaying all the HTTP calls that a server receives as is to all the peers. This limits scalability as every node has to withstand the entire write load on eureka.</li></ul><p>Although Eureka 2.0 provides a more richer feature set, the above limitations are the major driving factors for the changes proposed in this version.
Based on the above motivations, Eureka 2.0 achieves the following improvements:</p><ul><li>Interest based subscription model for registry data: A client of Eureka is able to select a part of the instance registry in which it is interested in and the eureka server only sends information about that part of the registry. Eg: A client can say I am only interested in application “WebFarm” and then the server will only send information about WebFarm instances. Eureka server provides various selection criterions and a way to update this interest set dynamically.</li><li>Push model from the server for any changes to the interest set: Instead of the current pull model from the client, Eureka servers pushes updates for changes to the interest set, to the client.</li><li>Optimized replication: As Eureka 1.0, Eureka 2.0 also follows a broadcast replication model i.e. every node replicates data to all other nodes. However, the replication algorithm is much more optimized eliminating the need of sending heartbeats for every instance in the registry. This drastically reduce the replication traffic and achieves much higher scalability.</li><li>Auto-scaled Eureka servers: Eureka 2.0 divides the read (discovery of data) and write (registration) concerns into separate clusters. Since, the write load is predictable (proportional to the number of instances in a region), the write cluster is pre-scaled. On the other hand, read load is unpredictable (proportional to subscriptions from clients) and hence the read farm is auto-scaled.</li><li>Audit log: Eureka 2.0 provides an elaborate audit log for any change done to the registry. This helps Eureka owners as well as users to get insight into debugging the state of individual application instances as exists in Eureka. The audit log by default is persisted to a log file, but different persistent storages can be plugged-in.</li><li>Dashboard: Eureka 2.0 provides a rich dashboard (as opposed to very rudimentary dashboard of Eureka 1.0) with insights into Eureka internals with respect to registry views, server health, subscription state, audit log, etc.</li></ul><p> 简单翻译总结，也就是Eureka1.0的架构主要存在如下的不足：</p><ul><li>订阅端拿到的是服务的全量的地址：这个对于客户端的内存是一个比较大的消耗，特别在多数据中心部署的情况下，某个数据中心的订阅端往往只需要同数据中心的服务提供端即可。</li><li>pull模式：客户端采用周期性向服务端主动pull服务数据的模式（也就是客户端轮训的方式），这个方式存在实时性不足以及无谓的拉取性能消耗的问题。</li><li>一致性协议：Eureka集群的多副本的一致性协议采用类似“异步多写”的AP协议，每一个server都会把本地接收到的写请求（register/heartbeat/unregister/update）发送给组成集群的其他所有的机器（Eureka称之为peer），特别是hearbeat报文是周期性持续不断的在client-&gt;server-&gt;all peers之间传送；这样的一致性算法，导致了如下问题<ul><li>每一台Server都需要存储全量的服务数据，Server的内存明显会成为瓶颈。</li><li>当订阅者却来越多的时候，需要扩容Eureka集群来提高读的能力，但是扩容的同时会导致每台server需要承担更多的写请求，扩容的效果不明显。</li><li>组成Eureka集群的所有server都需要采用相同的物理配置，并且只能通过不断的提高配置来容纳更多的服务数据</li></ul></li></ul><p>Eureka2.0主要就是为了解决上述问题而提出的，主要包含了如下的改进和增强</p><ul><li>数据推送从pull走向push模式，并且实现更小粒度的服务地址按需订阅的功能。</li><li>读写分离：写集群相对稳定，无需经常扩容；读集群可以按需扩容以提高数据推送能力。</li><li>新增审计日志的功能和功能更丰富的Dashboard。</li></ul><p>Eureka1.0版本存在的问题以及Eureka2.0架构设想和阿里巴巴内部的同类产品ConfigServer所经历的阶段非常相似（甚至Eureka2.0如果真的落地后存在的问题，阿里巴巴早已经发现并且已经解决），下面我带着你来回顾一下我们所经历过的。</p><h1>阿里巴巴服务注册中心ConfigServer技术发现路线</h1><p>阿里巴巴早在2008就开始了服务化的进程，在那个时候就就已经自研出服务发现解决方案（内部产品名叫ConfigServer）。</p><p>当2012年9月1号Eureka放出第一个1.1.2版本的时候，我们把ConfigServer和Eureka进行了深度的对比，希望能够从Eureka找到一些借鉴来解决当时的ConfigServer发展过程中碰到的问题（后面会提到）；然而事与愿违，我们已经发现Eureka1.x架构存在比较严重的扩展性和实时性的问题（正如上面所描述的），这些问题ConfigServer当时的版本也大同小异的存在，我们在2012年底对ConfigServer的架构进行了升级来解决这些问题。</p><p>当2015年Eureka社区放出2.0架构升级的声音的时候，我们同样第一时间查看了2.0的目标架构设计，我们惊奇的发现Eureka的这个新的架构同2012年底ConfigServer的架构非常相似，当时一方面感慨“英雄所见略同”，另一方也有些失望，因为ConfigServer2012年的架构早就无法满足阿里巴巴内部的发展诉求了。</p><p>下面我从头回顾一下，阿里巴巴的ConfigServer的技术发展过程中的几个里程碑事件。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2008年无configserver的时代">2008年，无ConfigServer的时代<a href="#2008年无configserver的时代" class="hash-link" aria-label="Direct link to 2008年，无ConfigServer的时代" title="Direct link to 2008年，无ConfigServer的时代">​</a></h2><p>借助用硬件负载设备F5提供的vip功能，服务提供方只提供vip和域名信息，调用方通过域名方式调用，所有请求和流量都走F5设备。</p><p>遇到的问题：</p><ul><li>负载不均衡：对于长连接场景，F5不能提供较好的负载均衡能力。如服务提供方发布的场景，最后一批发布的机器，基本上不能被分配到流量。需要在发布完成后，PE手工去断开所有连接，重新触发连接级别的负载均衡。</li><li>流量瓶颈：所有的请求都走F5设备，共享资源，流量很容易会打满网卡，会造成应用之间的相互影响。</li><li>单点故障：F5设备故障之后，所有远程调用会被终止，导致大面积瘫痪。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2008年configserver单机版v10">2008年，ConfigServer单机版V1.0<a href="#2008年configserver单机版v10" class="hash-link" aria-label="Direct link to 2008年，ConfigServer单机版V1.0" title="Direct link to 2008年，ConfigServer单机版V1.0">​</a></h2><p>单机版定义和实现了服务发现的关键的模型设计（包括服务发布，服务订阅，健康检查，数据变更主动推送，这个模型至今仍然适用），应用通过内嵌SDK的方式接入实现服务的发布和订阅；这个版本很重要的一个设计决策就是服务数据变更到底是pull还是push的模式，我们从最初就确定必须采用push的模式来保证数据变更时的推送实时性（Eureka1.x的架构采用的是pull的模式）</p><p>当时，HSF和Notify就是采用单机版的ConfigServer来完成服务的发现和topic的发现。单机版的ConfigServer和HSF、Notify配合，采用服务发现的技术，让请求通过端到端的方式流动，避免产生流量瓶颈和单点故障。ConfigServer可以动态的将服务地址推送到客户端，服务调用者可以知道所有提供此服务的机器，每个请求都可以通过随机或者轮询的方式选择服务端，做到请求级别的负载均衡。这个版本已经能很好的解决F5设备不能解决的三个问题。</p><p>但是单机版本的问题也非常明显，不具备良好的容灾性；</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2009年初configserver单机版v15">2009年初，ConfigServer单机版V1.5<a href="#2009年初configserver单机版v15" class="hash-link" aria-label="Direct link to 2009年初，ConfigServer单机版V1.5" title="Direct link to 2009年初，ConfigServer单机版V1.5">​</a></h2><p>单机版的ConfigServer所面临的问题就是当ConfigServer在发布/升级的时候，如果应用刚好也在发布，这个时候会导致订阅客户端拿不到服务地址的数据，影响服务的调用；所以当时我们在SDK中加入了本地的磁盘缓存的功能，应用在拿到服务端推送的数据的时候，会先写入本地磁盘，然后再更新内存数据；当应用重启的时候，优先从本地磁盘获取服务数据；通过这样的方式解耦了ConfigServer和应用发布的互相依赖；这个方式沿用至今。（我很惊讶，Eureka1.x的版本至今仍然没有实现客户端磁盘缓存的功能，难道Eureka集群可以保持100%的SLA吗？）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2009年7月configserver集群版本v20">2009年7月，ConfigServer集群版本V2.0<a href="#2009年7月configserver集群版本v20" class="hash-link" aria-label="Direct link to 2009年7月，ConfigServer集群版本V2.0" title="Direct link to 2009年7月，ConfigServer集群版本V2.0">​</a></h2><p>ConfigServer的集群版本跟普通的应用有一些区别：普通的应用通过服务拆分后，已经属于无状态型，本身已经具备良好的可扩展性，单机变集群只是代码多部署几台；ConfigServer是有状态的，内存中的服务信息就是数据状态，如果要支持集群部署，这些数据要不做分片，要不做全量同步；由于分片的方案并没有真正解决数据高可用的问题（分片方案还需要考虑对应的failover方案），同时复杂度较高；所以当时我们选择了单机存储全量服务数据全量的方案。为了简化数据同步的逻辑，服务端使用客户端模式同步：服务端收到客户端请求后，通过客户端的方式将此请求转发给集群中的其他的ConfigServer，做到同步的效果，每一台ConfigServer都有全量的服务数据。</p><p>这个架构同Eureka1.x的架构惊人的相似，所以很明显的Eureka1.x存在的问题我们也存在；当时的缓解的办法是我们的ConfigServer集群全部采用高配物理来部署。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2010年底configserver集群版v25">2010年底，ConfigServer集群版V2.5<a href="#2010年底configserver集群版v25" class="hash-link" aria-label="Direct link to 2010年底，ConfigServer集群版V2.5" title="Direct link to 2010年底，ConfigServer集群版V2.5">​</a></h2><p>基于客户端模式在集群间同步服务数据的方案渐渐无以为继了，特别是每次应用在发布的时候产生了大量的服务发布和数据推送，服务器的网卡经常被打满，同时cmsgc也非常频繁；我们对数据同步的方案进行了升级，去除了基于客户端的同步模式，采用了批量的基于长连接级别的数据同步+周期性的renew的方案来保证数据的一致性（这个同步方案当时还申请了国家专利）；这个版本还对cpu和内存做了重点优化，包括同步任务的合并，推送任务的合并，推送数据的压缩，优化数据结构等；</p><p>这个版本是ConfigServer历史上一个比较稳定的里程碑版本。</p><p>但是随着2009年天猫独创的双十一大促活动横空出世，服务数量剧增，应用发布时候ConfigServer集群又开始了大面积的抖动，还是体现在内存和网卡的吃紧，甚至渐渐到了fullgc的边缘；为了提高数据推送能力，需要对集群进行扩容，但是扩容的同时又会导致每台服务器的写能力下降，我们的架构到了“按下葫芦浮起瓢”的瓶颈。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2012年底configserver集群版v30">2012年底，ConfigServer集群版V3.0<a href="#2012年底configserver集群版v30" class="hash-link" aria-label="Direct link to 2012年底，ConfigServer集群版V3.0" title="Direct link to 2012年底，ConfigServer集群版V3.0">​</a></h2><p>在2011年双十一之前我们完成了V3架构的落地，类似Eureka2.0所设计的读写分离的方案，我们把ConfigServer集群拆分成session和data两个集群，客户端分片的把服务数据注册到session集群中，session集群会把数据异步的写到data集群，data集群完成服务数据的聚合后，把压缩好的服务数据推送到session层缓存下来，客户端可以直接从session层订阅到所需要的服务数据；这个分层架构中，session是分片存储部分的服务数据的（我们设计了failover方案），data存储的是全量服务数据（天生具备failover能力）；</p><p>data集群相对比较稳定，不需要经常扩容；session集群可以根据数据推送的需求很方便的扩容（这个思路和Eureka2.0所描述的思路是一致的）；session的扩容不会给data集群带来压力的增加。session集群我们采用低配的虚拟机即可满足需求，data由于存储是全量的数据我们仍然采用了相对高配的物理机（但是同V2.5相比，对物理机的性能要求已经答复下降）</p><p>这个版本也是ConfigServer历史上一个划时代的稳定的大版本。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2014年configserver集群版v35">2014年，ConfigServer集群版V3.5<a href="#2014年configserver集群版v35" class="hash-link" aria-label="Direct link to 2014年，ConfigServer集群版V3.5" title="Direct link to 2014年，ConfigServer集群版V3.5">​</a></h2><p>2013年，阿里巴巴开始落地了异地多活方案，从一个IDC渐渐往多个IDC跨越，随之而来的对流量的精细化管控要求越来越高（比如服务的同机房调用，服务流量的调拨以支持灰度能力等），基于这个背景ConfigServer引入了服务元数据的概念，支持对服务和IP进行元数据的打标来满足各种各样的服务分组诉求。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2017年configserver集群版v40">2017年，ConfigServer集群版V4.0<a href="#2017年configserver集群版v40" class="hash-link" aria-label="Direct link to 2017年，ConfigServer集群版V4.0" title="Direct link to 2017年，ConfigServer集群版V4.0">​</a></h2><p>V3版本可见的一个架构的问题就是data集群是存储全量的服务数据的，这个随着服务数的与日俱增一定会走到升级物理机配置也无法解决问题的情况（我们当时已经在生产使用了G1的垃圾回收算法），所以我们继续对架构进行升级，基于V3的架构进行升级其实并不复杂；session层的设计保持不变，我们把data进行分片，每一个分片同样按照集群的方式部署以支持failover的能力；</p><table><thead><tr><th></th><th>ConfigServer</th><th>Eureka</th></tr></thead><tbody><tr><td>2008年</td><td>V1.0：单机版，定义了服务发现的领域模型</td><td></td></tr><tr><td>2009年初</td><td>V1.5：应用和ConfigServer集群发布解耦</td><td></td></tr><tr><td>2009年7月</td><td>V2.0：基于客户端模式同步数据，支持集群部署</td><td></td></tr><tr><td>2010年底</td><td>V2.5：优化集群间数据同步模式，申请国家专利。</td><td></td></tr><tr><td>2012年9月1号</td><td></td><td>Eureka1.0正式开源</td></tr><tr><td>2012年底</td><td>V3.0：支持session和data分层部署</td><td></td></tr><tr><td>2014年</td><td>V3.5：支持异地多活等细分场景</td><td></td></tr><tr><td>2015年</td><td></td><td>Eureka2.0架构升级方案公布</td></tr><tr><td>2017年</td><td>V4.0：支持data分片能力</td><td></td></tr><tr><td>2018年7月</td><td></td><td>Eureka2.0架构升级宣布停止</td></tr></tbody></table><h1>Nacos</h1><p>作为同属于AP类型的注册中心，Eureka和ConfigServer发展过程中所面临的诸多问题有很大的相似性，但是阿里巴巴这些年业务的跨越式发展，每年翻番的服务规模，不断的给ConfigServer的技术架构演进带来更高的要求和挑战，我们有更多的机会在生产环境发现和解决一个个问题的过程中，做架构的一代代升级。我们正在计划通过开源的手段把我们这些年在生产环境上的实践经验通过Nacos(<a href="http://nacos.io" target="_blank" rel="noopener noreferrer">链接</a>)产品贡献给社区，一方面能够助力和满足同行们在微服务落地过程当中对工业级注册中心的诉求，另一方面也希望通过开源社区及开源生态的协同发展给ConfigServer带来更多的可能性。</p><p>炎炎夏日，在Eureka 2.0 (Discontinued) 即将结束的时候，在同样的云原生时代，Nacos却正在迎来新生，技术演进和变迁的趣味莫过于此。</p><p>Nacos将努力继承Eureka未竟的遗志，扛着AP系注册中心的旗帜继续前行，不同的是Nacos更关注DNS-based Service Discovery以及与Kubernetes体系的融会贯通。</p><p>我们看不透未来，却仍将与同行们一起上下求索，砥砺前行。</p><p>最后附上Nacos的架构图。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/12425/1530856061648-7180b97f-b61d-4127-924e-a0743b9e9d5a.png" alt="屏幕快照 2018-06-28 下午4.58.59.png | center | 748x544" class="img_ev3q"></p></div></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/blog/page/5"><div class="pagination-nav__label">Newer Entries</div></a></nav></main></div></div></div></div>
<script src="/en/assets/js/runtime~main.2f81187a.js"></script>
<script src="/en/assets/js/main.1ba25a89.js"></script>
</body>
</html>