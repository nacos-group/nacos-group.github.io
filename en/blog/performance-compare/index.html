<!doctype html>
<html lang="en-US" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Performance comparison between Nacos 2.0 upgrading or not. | Nacos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nacos.io/en/img/nacos_colorful.png"><meta data-rh="true" name="twitter:image" content="https://nacos.io/en/img/nacos_colorful.png"><meta data-rh="true" property="og:url" content="https://nacos.io/en/blog/performance-compare"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Performance comparison between Nacos 2.0 upgrading or not. | Nacos"><meta data-rh="true" name="description" content="Nacos 2.0 improved the performance about 10 times by upgrading the communication protocol, framework, and data model, to solve the performance problems gradually exposed after the release of Nacos 1.0. In this article, Nacos1.0, Nacos1.0 upgrade Nacos2.0 process, Nacos2.0 to conduct a comprehensive performance comparison, in order to intuitively show the performance improvement brought by Nacos2.0."><meta data-rh="true" property="og:description" content="Nacos 2.0 improved the performance about 10 times by upgrading the communication protocol, framework, and data model, to solve the performance problems gradually exposed after the release of Nacos 1.0. In this article, Nacos1.0, Nacos1.0 upgrade Nacos2.0 process, Nacos2.0 to conduct a comprehensive performance comparison, in order to intuitively show the performance improvement brought by Nacos2.0."><meta data-rh="true" name="keywords" content="2,Performance test,Performance comparing"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-07-29T00:00:00.000Z"><link data-rh="true" rel="icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"><link data-rh="true" rel="canonical" href="https://nacos.io/en/blog/performance-compare"><link data-rh="true" rel="alternate" href="https://nacos.io/en/blog/performance-compare" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://nacos.io/zh-cn/blog/performance-compare" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://nacos.io/blog/performance-compare" hreflang="default"><link data-rh="true" rel="alternate" href="https://nacos.io/blog/performance-compare" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://1QV814950M-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Nacos RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Nacos Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Nacos" href="/en/opensearch.xml">


<meta name="aes-config" content="pid=xux-opensource&amp;user_type=101&amp;uid=&amp;username=&amp;dim10=nacos">
<meta name="referrer" content="no-referrer">
<link rel="stylesheet" href="//dev.g.alicdn.com/mamba/mse-arc-ui/0.0.20/umd/mse-arc-ui.min.css">
<script src="//dev.g.alicdn.com/mamba/mse-arc-ui/0.0.20/umd/mse-arc-ui.min.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-0YDFJ7LX7F" async></script><link rel="stylesheet" href="/en/assets/css/styles.d254cbd7.css">
<link rel="preload" href="/en/assets/js/runtime~main.298c6cbc.js" as="script">
<link rel="preload" href="/en/assets/js/main.4acdee8f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>



<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script>
<script src="//hm.baidu.com/hm.js?e3a5cec56ef8619cf9d7c2abebd509e3"></script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/nacos_colorful.png" alt="Nacos Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/nacos_colorful.png" alt="Nacos Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://nacos.io/zh-cn/docs/v2/quickstart/quick-start.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"> </a><a class="navbar__item navbar__link" href="/en/">Home</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="/what-is-nacos" href="/en/docs/v2/what-is-nacos">2.X</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/next/v2/what-is-nacos">User Docs</a></li><li><a class="dropdown__link" href="/en/docs/v2/what-is-nacos">2.X</a></li><li><a class="dropdown__link" href="/en/docs/1.X/v2/what-is-nacos">1.X</a></li></ul></div><a class="navbar__item navbar__link" href="/en/cloud">NACOS CLOUD</a><a href="https://developer.aliyun.com/ebook/36?spm=a2c6h.20345107.ebook-index.18.152c2984fsi5ST" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">E-BOOK-NACOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/blog">BLOG</a><a class="navbar__item navbar__link" href="/en/community">COMMUNITY</a><a href="http://console.nacos.io/nacos/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">DEMO-CONSOLE<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>En</a><ul class="dropdown__menu"><li><a href="/en/blog/performance-compare" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">En</a></li><li><a href="/zh-cn/blog/performance-compare" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.1.1-release">2.1.1-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.2.0-release">2.2.0-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.2.1-release">2.2.1-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.2.2-release">2.2.2-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/212-and-220beta-release">212-and-220beta-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/announcement-token-secret-key">announcement-token-secret-key</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/higress">higress</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/iscas2023">iscas2023</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-distro-mechanism">nacos-distro-mechanism</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-reigster-mechanism">nacos-reigster-mechanism</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/springboot-0.2.10">springboot-0.2.10</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/up-to-2w-star">up-to-2w-star</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/xiaomi-scale">xiaomi-scale</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos3.0-is-coming">我们总结了3大使用建议，并首次公开 Nacos3.0 规划图 | Nacos 开源4周年</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/iscas2022">Nacos开源之夏，贡献社区赢取12000奖金</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.1.0-release">Nacos 2.1.0版本发布，支持鉴权及加解密插件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/use-nacos-with-rainbond">Install the HA Nacos cluster in Rainbond with one-click</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/apisix">Apache APISIX Realizes Service Discovery Based on Nacos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.0.3-release">Nacos 2.0.3 Release, continue to improve stability.</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/en/blog/performance-compare">Performance comparison between Nacos 2.0 upgrading or not.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/iscas2021">Nacos ISCAS 2021 start to apply</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.0.1-release">Nacos 2.0.1 + 1.4.2 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/1.4.0-release">Nacos 1.4.0 + Go SDK 1.0.1 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/csharp-0.5.0">v0.5.0 of Nacos-sdk-csharp was released! Capabilities aligned with Java SDK！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-2nd-anniversary">Nacos 两周年献礼，Nacos 1.3.2 + Go SDK 1.0.0发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/feeling-of-ASoC-2019">参与开源，Offer拿到手软 -- 来自一名2019阿里巴巴编程之夏同学的亲述</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos 1.2.0 guide">Nacos 1.2.0权限控制介绍和使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-1.3.0-design">Nacos 1.3.0 new kernel construction process</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/namespace-endpoint-best-practices">Namespace,endpoint 最佳实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/pilot mcp">Pilot MCP协议介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos 1.1.4">Nacos 1.1.4发布，业界率先支持Istio MCP协议</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-confd">Nacos整合Confd，支持nginx配置管理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/eureka2">Eureka 2.0 开源工作宣告停止？别担心，ANS 即将 C位强势出道！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos 1.1.0">Nacos 1.1.0发布，支持灰度配置和地址服务器模块</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-roadmap">Nacos GA后的整体规划</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cmdb">Nacos打通CMDB实现就近访问</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/address-server">阿里巴巴基于 Nacos 实现环境隔离的实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos1.0.0">Nacos 1.0.0 发布，正式大规模生产可用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.9.0">Nacos 0.9.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.9-intro">Nacos 0.9.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/huya-practice">虎牙直播在微服务改造方面的实践和总结</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.8">Nacos 0.8.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/huya-nacos">虎牙直播共建Nacos生态</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/5w1h-where">Nacos 有哪些典型的应用场景？—— 配置管理篇</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/dynamic-route-zuul-nacos">使用Nacos实现Spring Cloud Zuul的动态路由</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.6">Nacos 0.6版本发布，支持Dubbo生态并且支持Docker部署</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.5">Nacos0.5发布，支持DNS-based Service Discovery，JAVA 11</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos">Nacos 0.1.0 版本Review 活动设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cncf">Nacos 进入CNCF landscape</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/5w1h-what">What problems does Nacos help us solve? —— Configuration Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/discovery-console">Nacos服务发现控制台预览</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/chengdu-dubbo">Nacos 计划发布v0.2版本，进一步融合Dubbo和SpringCloud生态</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/consul-k8s">Consul与kubernetes整合公告[翻译]</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/dns-sd">微服务架构中基于DNS的服务注册与发现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-is-coming">支持Dubbo生态发展，阿里巴巴启动新的开源项目 Nacos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/alibaba-configserver">阿里巴巴服务注册中心产品ConfigServer 10年技术发展回顾</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 2.0 improved the performance about 10 times by upgrading the communication protocol, framework, and data model, to solve the performance problems gradually exposed after the release of Nacos 1.0. In this article, Nacos1.0, Nacos1.0 upgrade Nacos2.0 process, Nacos2.0 to conduct a comprehensive performance comparison, in order to intuitively show the performance improvement brought by Nacos2.0."><meta itemprop="keywords" content="2,Performance test,Performance comparing"><header><h1 class="title_f1Hy" itemprop="headline">Performance comparison between Nacos 2.0 upgrading or not.</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-07-29T00:00:00.000Z" itemprop="datePublished">July 29, 2021</time> · <!-- -->8 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Nacos2.0通过升级通信协议和框架、数据模型的方式将性能提升了约10倍，解决继 Nacos 1.0 发布逐步暴露的性能问题。本文通过压测 Nacos1.0，Nacos1.0升级Nacos2.0过程中，Nacos2.0 进行全面性能对比，直观的展示Nacos2.0所带来的性能提升。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="压测准备">压测准备<a href="#压测准备" class="hash-link" aria-label="Direct link to 压测准备" title="Direct link to 压测准备">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="环境准备">环境准备<a href="#环境准备" class="hash-link" aria-label="Direct link to 环境准备" title="Direct link to 环境准备">​</a></h3><p>为了方便Nacos部署升级和展示核心性能指标，我们是从<a href="https://cn.aliyun.com/product/aliware/mse" target="_blank" rel="noopener noreferrer">阿里云微服务引擎MSE</a>中购买的一个2核CPU+4G内存的三节点Nacos集群。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="压测模型">压测模型<a href="#压测模型" class="hash-link" aria-label="Direct link to 压测模型" title="Direct link to 压测模型">​</a></h3><p>为了展示不同规模下的系统表现，我们采用逐步增压的方式进行压测，将压力分为3个批次进行逐步启动，并观察每个批次下集群的运行表现。同时会在压力集群之外，再增加一个Dubbo服务的Demo，并使用Jmeter以100TPS的压力不停的调用，以模拟不同压力下，对实际业务调用存在的可能影响。</p><p>压测过程中，会在适当的时候对服务端和客户端进行升级；服务端的升级将直接使用MSE提供的一键升级功能，客户端的升级会使用分批次轮流重启的方式进行。</p><p><img loading="lazy" alt="压测模型" src="/en/assets/images/performance_model-97b609e8d29e6ec0b5b084d1da365c25.jpg" width="1550" height="732" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="压测过程">压测过程<a href="#压测过程" class="hash-link" aria-label="Direct link to 压测过程" title="Direct link to 压测过程">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos1x-server--nacos1x-client">Nacos1.X Server + Nacos1.X Client<a href="#nacos1x-server--nacos1x-client" class="hash-link" aria-label="Direct link to Nacos1.X Server + Nacos1.X Client" title="Direct link to Nacos1.X Server + Nacos1.X Client">​</a></h3><p>首先启动第一批施压集群，对MSE Nacos1.2.1进行施压，在6000个Providers的压力下，集群稳定时CPU大约25%，能够稳定保持6000实例。</p><p><img loading="lazy" alt="1.X6000实例CPU" src="/en/assets/images/1_6000_cpu-baab16c555248319a7e3751f105cb749.jpg" width="3098" height="508" class="img_ev3q">
<img loading="lazy" alt="1.X6000实例" src="/en/assets/images/1_6000_instance-aee611f962310aa4be0f35730054ff5f.jpg" width="3096" height="504" class="img_ev3q"></p><p>随后启动第二批施压集群，增加4000个Provider，合集10000个Provider。此时集群峰值CPU已经达到60%，稳定运行时大约在45%左右，集群能够稳定运行。</p><p><img loading="lazy" alt="1.X10000实例CPU" src="/en/assets/images/1_10000_cpu-a695b8af2bbff9a9109f1724f1d1b74a.jpg" width="3060" height="490" class="img_ev3q">
<img loading="lazy" alt="1.X10000实例" src="/en/assets/images/1_10000_instance-ce3c6f41290b3243a49d0824d5af1bbb.jpg" width="3024" height="502" class="img_ev3q"></p><p>在前两批的压力下，集群没有出现稳定性问题，所以Dubbo的调用保持正常，没有错误发生。</p><p><img loading="lazy" alt="1.X10000实例Dubbo" src="/en/assets/images/1_10000_dubbo-da8dd7d0766c57e101626142e0bb3760.png" width="1064" height="481" class="img_ev3q"></p><p>当第三批施压集群启动之后，压力总计14000个Provider。此时集群先是短暂的注册到13000个实例，之后很快出现实例数下跌，CPU跑满的问题。并且缩小时间范围可以看到，下跌后的实例仍然在小范围抖动。</p><p><img loading="lazy" alt="1.X14000实例CPU" src="/en/assets/images/1_14000_cpu-00b8c49ccf573f6c05ee87135f6af20e.jpg" width="3030" height="496" class="img_ev3q">
<img loading="lazy" alt="1.X14000实例" src="/en/assets/images/1_14000_instance-a8b02f1b13cf6309300be3004b5ac67c.jpg" width="3018" height="480" class="img_ev3q">
<img loading="lazy" alt="1.X14000实例抖动" src="/en/assets/images/1_14000_instance_shake-40f671422fd0ee548fedf18251dd90db.jpg" width="3026" height="512" class="img_ev3q"></p><p>同时Dubbo的调用出现错误，从Consumer的日志可以看出，是由于服务端无法支撑这个级别的压力，导致Dubbo Provider被摘除，所以调用的时候出现了<code>No provider</code>的错误。</p><p><img loading="lazy" alt="1.X14000实例Dubbo" src="/en/assets/images/1_14000_dubbo-5fa816b30338e3e9cd77fe21c416e649.png" width="1064" height="481" class="img_ev3q">
<img loading="lazy" alt="1.X14000实例Dubbo错误" src="/en/assets/images/1_14000_dubbo_error-dac9eef0c76a5d4b3d53175d66edd504.jpg" width="3566" height="312" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos2x-server--nacos1x-client">Nacos2.X Server + Nacos1.X Client<a href="#nacos2x-server--nacos1x-client" class="hash-link" aria-label="Direct link to Nacos2.X Server + Nacos1.X Client" title="Direct link to Nacos2.X Server + Nacos1.X Client">​</a></h3><p>由于服务端升级期间，会进行实例的双写操作，因此在升级过程中服务端存储的实例数会是实际实例值的两倍。根据上述测试结果，需要先将实例数回滚回第一批6000实例之后，或是升级配置扩容机器之后再尝试升级。本文使用回滚压力的方式，先停止后启动的施压集群。让集群恢复正常后再执行升级。</p><p><img loading="lazy" alt="升级前6000实例CPU" src="/en/assets/images/before_upgrade_cpu-d1c74733549728383a3fa828af094e3a.jpg" width="3088" height="486" class="img_ev3q">
<img loading="lazy" alt="升级前6000实例" src="/en/assets/images/before_upgrade_instance-2fe6c5eb295715f6124ce8e752d9c4b9.jpg" width="3052" height="482" class="img_ev3q">
<img loading="lazy" alt="升级前6000实例Dubbo" src="/en/assets/images/before_upgrade_dubbo-aa23e93668a3100461e9857ace56e8b1.png" width="1064" height="481" class="img_ev3q"></p><p>从监控图中可以看出，在停止后两批压力后，集群很快就恢复到了正常，运行稳定，Dubbo调用也恢复正常。之后使用MSE的升级功能，进行升级。升级过程中由于双写的性能损耗，导致CPU有较大的抖动；而且因为双写导致的实例数翻倍，实际上相当于12000实例的极限压力，服务端仍然有一定的抖动，因此导致了些许Dubbo的错误。若是在非极限压力下升级，将不会有此影响。</p><p><img loading="lazy" alt="升级后14000实例CPU" src="/en/assets/images/upgrading_cpu-8adead39922245f9d0bfb04e163f1a0c.jpg" width="3064" height="464" class="img_ev3q">
<img loading="lazy" alt="升级后14000实例" src="/en/assets/images/upgrading_instance-73fb6bb6f225e9cd00bc9e248e243661.jpg" width="3040" height="482" class="img_ev3q">
<img loading="lazy" alt="升级后14000实例Dubbo" src="/en/assets/images/upgrading_dubbo-408e2ea28e28e757151720ab66060edd.png" width="1064" height="481" class="img_ev3q"></p><p>随着服务端升级完成停止双写，消除了双写带来的性能损耗，CPU使用降低并趋于稳定，同时实例数也不再抖动，Dubbo调用完全恢复；如同1.X服务端一样，分两个批次启动施压集群，对比两个版本间在相同压力下的性能表现。</p><p><img loading="lazy" alt="升级后14000实例CPU" src="/en/assets/images/after_upgrade_cpu-7cafc402fa20692fc047a08a71d96354.jpg" width="3106" height="510" class="img_ev3q">
<img loading="lazy" alt="升级后14000实例" src="/en/assets/images/after_upgrade_instance-5745811ef8147996d0a3d3e478f492bd.jpg" width="3114" height="512" class="img_ev3q">
<img loading="lazy" alt="升级后14000实例Dubbo" src="/en/assets/images/after_upgrade_dubbo-7eb99da583572f6351a451c75a4a9ec2.png" width="1064" height="481" class="img_ev3q"></p><p>由于客户端依旧使用的是1.X的客户端，服务端的使用水位依然非常高，在全部压力启动后，CPU几乎达到100%；虽然没有像1.X服务端一样，出现大规模实例下跌，但是运行一段时间后依旧有少量的实例抖动，说明仅升级Nacos服务端到2.0版本能有一定的改善，但是没有彻底解决性能问题。</p><p><img loading="lazy" alt="升级后14000实例抖动" src="/en/assets/images/after_upgrade_instance_shake-88a15bfc8b3b8156ad61338d622c1e52.jpg" width="3032" height="470" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos2x-server--nacos2x-client">Nacos2.X Server + Nacos2.X Client<a href="#nacos2x-server--nacos2x-client" class="hash-link" aria-label="Direct link to Nacos2.X Server + Nacos2.X Client" title="Direct link to Nacos2.X Server + Nacos2.X Client">​</a></h3><p>为了完全释放Nacos2.0的性能，还需要将施压集群的客户端也升级到2.0以上版本。同样将分3个批次进行替换，期间由于Provider进行了重启，服务端有出现实例的下跌再恢复属于正常现象。随着施压集群的升级，可以发现CPU有了非常明显的下降，最终达到稳定时，CPU由最初的接近100%，降低到20%，集群稳定运行14000个实例。</p><p><img loading="lazy" alt="2.X14000实例CPU" src="/en/assets/images/2_14000_cpu-549f6b56287ca04b59041dfa4b28068f.jpg" width="3114" height="514" class="img_ev3q">
<img loading="lazy" alt="2.X14000实例" src="/en/assets/images/2_14000_instance-747758b3881f3abb6e1330f1452547a9.jpg" width="3100" height="514" class="img_ev3q">
<img loading="lazy" alt="2.X14000实例Dubbo" src="/en/assets/images/2_14000_dubbo-24cd3e2e0bbe884335ced04e2cdeb4be.png" width="1064" height="481" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="压测结果">压测结果<a href="#压测结果" class="hash-link" aria-label="Direct link to 压测结果" title="Direct link to 压测结果">​</a></h2><p>如上所述，我们能够得到<code>2核CPU+4G内存</code>的三节点集群在不同版本下的性能差异：</p><table><thead><tr><th>服务端版本</th><th>客户端版本</th><th>压力规模</th><th>集群稳定性</th><th>CPU使用</th></tr></thead><tbody><tr><td>Nacos1.X</td><td>Nacos1.X</td><td>14000</td><td>完全不稳定</td><td>100%</td></tr><tr><td>Nacos2.X（升级中）</td><td>Nacos1.X</td><td>6000</td><td>有一定抖动</td><td>100%</td></tr><tr><td>Nacos2.X</td><td>Nacos1.X</td><td>14000</td><td>有一定抖动</td><td>100%</td></tr><tr><td>Nacos2.X</td><td>Nacos2.X</td><td>14000</td><td>稳定</td><td>20%</td></tr></tbody></table><p>由此可见，Nacos2.0确实对性能有较大的提升，新用户建议直接全部采用Nacos2.0，老用户建议先升级Server端，然后在逐步升级客户端释放红利。最后从整个压测视角的监控，来直观的感受一下不同版本在不同阶段的性能表现：</p><p><img loading="lazy" alt="监控纵览" src="/en/assets/images/all-ba420b22959bd95a783dd0e6d843ecd4.jpg" width="1919" height="665" class="img_ev3q"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/blog/2.0.3-release"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Nacos 2.0.3 Release, continue to improve stability.</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/blog/iscas2021"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Nacos ISCAS 2021 start to apply</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#压测准备" class="table-of-contents__link toc-highlight">压测准备</a><ul><li><a href="#环境准备" class="table-of-contents__link toc-highlight">环境准备</a></li><li><a href="#压测模型" class="table-of-contents__link toc-highlight">压测模型</a></li></ul></li><li><a href="#压测过程" class="table-of-contents__link toc-highlight">压测过程</a><ul><li><a href="#nacos1x-server--nacos1x-client" class="table-of-contents__link toc-highlight">Nacos1.X Server + Nacos1.X Client</a></li><li><a href="#nacos2x-server--nacos1x-client" class="table-of-contents__link toc-highlight">Nacos2.X Server + Nacos1.X Client</a></li><li><a href="#nacos2x-server--nacos2x-client" class="table-of-contents__link toc-highlight">Nacos2.X Server + Nacos2.X Client</a></li></ul></li><li><a href="#压测结果" class="table-of-contents__link toc-highlight">压测结果</a></li></ul></div></div></div></div></div></div>
<script src="/en/assets/js/runtime~main.298c6cbc.js"></script>
<script src="/en/assets/js/main.4acdee8f.js"></script>
</body>
</html>