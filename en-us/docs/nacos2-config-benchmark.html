<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="Nacos,服务,配置,性能" />
	<meta name="description" content="Nacos2.0服务配置性能测试报告" />
  <meta name="baidu-site-verification" content="code-wzq5sw7io3" />
	<!-- 网页标签标题 -->
	<title>Nacos2.0服务配置性能测试报告</title>
	<link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot="" data-reactid="1" data-react-checksum="-505347357"><header class="header-container header-container-normal" data-reactid="2"><div class="header-body" data-reactid="3"><a href="/en-us/index.html" data-reactid="4"><img class="logo" src="/img/nacos_colorful.png" data-reactid="5"/></a><div class="search search-normal" data-reactid="6"><span class="icon-search" data-reactid="7"></span></div><span class="language-switch language-switch-normal" data-reactid="8">中</span><div class="header-menu" data-reactid="9"><img class="header-menu-toggle" src="/img/menu_gray.png" data-reactid="10"/><ul data-reactid="11"><li class="menu-item menu-item-normal" data-reactid="12"><span data-reactid="13"><a href="/en-us/index.html" data-reactid="14">HOME</a></span></li><li class="menu-item menu-item-normal menu-item-normal-active" data-reactid="15"><span data-reactid="16"><a href="/en-us/docs/quick-start.html" data-reactid="17">DOCS</a></span></li><li class="menu-item menu-item-normal" data-reactid="18"><div class="nav-container" data-reactid="19"><div class="word" data-reactid="20"><a data-reactid="21">SOLUTIONS</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png" data-reactid="22"/></div><ul class="sub-nav-container" style="width:290px;" data-reactid="23"><li data-reactid="24"><a href="https://www.alibabacloud.com/product/microservices-engine" target="_blank" data-reactid="25">Microservice Solution</a></li><li data-reactid="26"><a href="https://cn.aliyun.com/product/aliware/sae?spm=nacos-website.topbar.0.0.0" target="_blank" data-reactid="27">Microservice on Serverless Solution</a></li><li data-reactid="28"><a href="https://www.aliyun.com/product/edas?spm=nacos-website.topbar.0.0.0" target="_blank" data-reactid="29">PaaS Solution</a></li><li data-reactid="30"><a href="https://www.aliyun.com/aliware/txc?spm=nacos-website.topbar.0.0.0" target="_blank" data-reactid="31">Distributed transaction Solution</a></li><li data-reactid="32"><a href="https://www.aliyun.com/product/ahas?spm=nacos-website.topbar.0.0.0" target="_blank" data-reactid="33">High-availability Solution</a></li><li data-reactid="34"><a href="https://www.aliyun.com/product/servicemesh?spm=nacos-website.topbar.0.0.0" target="_blank" data-reactid="35">Service mesh Solution</a></li></ul><!-- react-text: 36 --> <!-- /react-text --></div></li><li class="menu-item menu-item-normal" data-reactid="37"><span data-reactid="38"><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" data-reactid="39">NACOS IN CLOUD</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png" data-reactid="40"/></span></li><li class="menu-item menu-item-normal" data-reactid="41"><span data-reactid="42"><a href="https://developer.aliyun.com/ebook/36?spm=a2c6h.20345107.ebook-index.18.152c2984fsi5ST" data-reactid="43">E-BOOK-NACOS</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png" data-reactid="44"/></span></li><li class="menu-item menu-item-normal" data-reactid="45"><span data-reactid="46"><a href="/en-us/blog" data-reactid="47">BLOG</a></span></li><li class="menu-item menu-item-normal" data-reactid="48"><span data-reactid="49"><a href="/en-us/community" data-reactid="50">COMMUNITY</a></span></li><li class="menu-item menu-item-normal" data-reactid="51"><span data-reactid="52"><a href="http://console.nacos.io/nacos/index.html" data-reactid="53">DEMO-CONSOLE</a></span></li></ul></div></div></header><div class="bar" data-reactid="54"><div class="bar-body" data-reactid="55"><img src="/img/docs.png" class="front-img" data-reactid="56"/><div class="bar-title" data-reactid="57"><span data-reactid="58">Documentation</span><div class="bone bone-light" data-reactid="59"></div></div><img src="/img/docs.png" class="back-img" data-reactid="60"/></div></div><section class="content-section" data-reactid="61"><div class="content-body" data-reactid="62"><div class="sidemenu" data-reactid="63"><div class="sidemenu-toggle" data-reactid="64"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png" data-reactid="65"/></div><ul data-reactid="66"><li class="menu-item menu-item-level-1" data-reactid="67"><span data-reactid="68">Nacos </span><ul data-reactid="69"><li style="height:180px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="70"><span data-reactid="71"><!-- react-text: 72 -->What is Nacos<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="73"/></span><ul data-reactid="74"><li class="menu-item menu-item-level-3" data-reactid="75"><a href="/en-us/docs/what-is-nacos.html" target="_self" data-reactid="76">What is Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="77"><a href="/en-us/docs/concepts.html" target="_self" data-reactid="78">Concepts</a></li><li class="menu-item menu-item-level-3" data-reactid="79"><a href="/en-us/docs/architecture.html" target="_self" data-reactid="80">Architecure</a></li><li class="menu-item menu-item-level-3" data-reactid="81"><a href="/en-us/docs/feature-list.html" target="_self" data-reactid="82">Feature list</a></li></ul></li><li style="height:180px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="83"><span data-reactid="84"><!-- react-text: 85 -->Nacos 2.0<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="86"/></span><ul data-reactid="87"><li class="menu-item menu-item-level-3" data-reactid="88"><a href="/en-us/docs/2.0.0-compatibility.html" target="_self" data-reactid="89">Compatibility&amp;Usage</a></li><li class="menu-item menu-item-level-3" data-reactid="90"><a href="/en-us/docs/2.0.0-upgrading.html" target="_self" data-reactid="91">Upgrading</a></li><li class="menu-item menu-item-level-3" data-reactid="92"><a href="/en-us/docs/auth-plugin.html" target="_self" data-reactid="93">Authentication Plugin</a></li><li class="menu-item menu-item-level-3" data-reactid="94"><a href="/en-us/docs/config-encryption.html" target="_self" data-reactid="95">Configure Encryption Plugin</a></li></ul></li><li style="height:324px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="96"><span data-reactid="97"><!-- react-text: 98 -->Quick Start<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="99"/></span><ul data-reactid="100"><li class="menu-item menu-item-level-3" data-reactid="101"><a href="/en-us/docs/quick-start.html" target="_self" data-reactid="102">Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="103"><a href="/en-us/docs/quick-start-spring.html" target="_self" data-reactid="104">Nacos Spring</a></li><li class="menu-item menu-item-level-3" data-reactid="105"><a href="/en-us/docs/quick-start-spring-boot.html" target="_self" data-reactid="106">Nacos Spring Boot</a></li><li class="menu-item menu-item-level-3" data-reactid="107"><a href="/en-us/docs/quick-start-spring-cloud.html" target="_self" data-reactid="108">Nacos Spring Cloud</a></li><li class="menu-item menu-item-level-3" data-reactid="109"><a href="/en-us/docs/quick-start-docker.html" target="_self" data-reactid="110">Nacos Docker</a></li><li class="menu-item menu-item-level-3" data-reactid="111"><a href="/en-us/docs/use-nacos-with-dubbo.html" target="_self" data-reactid="112">Nacos with Dubbo</a></li><li class="menu-item menu-item-level-3" data-reactid="113"><a href="/en-us/docs/use-nacos-with-kubernetes.html" target="_self" data-reactid="114">Nacos with K8s</a></li><li class="menu-item menu-item-level-3" data-reactid="115"><a href="/en-us/docs/nacos-sync.html" target="_self" data-reactid="116">Nacos Sync</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="117"><span data-reactid="118"><!-- react-text: 119 -->User Guide<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="120"/></span><ul data-reactid="121"><li class="menu-item menu-item-level-3" data-reactid="122"><a href="/en-us/docs/sdk.html" target="_self" data-reactid="123">Java SDK</a></li><li class="menu-item menu-item-level-3" data-reactid="124"><a href="/en-us/docs/other-language.html" target="_self" data-reactid="125">Other Language</a></li><li class="menu-item menu-item-level-3" data-reactid="126"><a href="/en-us/docs/open-api.html" target="_self" data-reactid="127">Open-API</a></li><li class="menu-item menu-item-level-3" data-reactid="128"><a href="/en-us/docs/nacos-spring.html" target="_self" data-reactid="129">Nacos Spring</a></li><li class="menu-item menu-item-level-3" data-reactid="130"><a href="/en-us/docs/system-configurations.html" target="_self" data-reactid="131">Nacos System Configurations</a></li><li class="menu-item menu-item-level-3" data-reactid="132"><a href="/en-us/docs/auth.html" target="_self" data-reactid="133">Authentication</a></li><li class="menu-item menu-item-level-3" data-reactid="134"><a href="/en-us/docs/faq.html" target="_self" data-reactid="135">FAQ</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="136"><span data-reactid="137"><!-- react-text: 138 -->Admin Guide<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="139"/></span><ul data-reactid="140"><li class="menu-item menu-item-level-3" data-reactid="141"><a href="/en-us/docs/deployment.html" target="_self" data-reactid="142">Deployment Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="143"><a href="/en-us/docs/cluster-mode-quick-start.html" target="_self" data-reactid="144">Cluster Mode Deployment</a></li><li class="menu-item menu-item-level-3" data-reactid="145"><a href="/en-us/docs/management-api.html" target="_self" data-reactid="146">Management OpenAPI</a></li><li class="menu-item menu-item-level-3" data-reactid="147"><a href="/en-us/docs/console-guide.html" target="_self" data-reactid="148">Admin Console Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="149"><a href="/en-us/docs/monitor-guide.html" target="_self" data-reactid="150">Nacos Monitor Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="151"><a href="/en-us/docs/nacos-config-benchmark.html" target="_self" data-reactid="152">Nacos Config Benchmark</a></li><li class="menu-item menu-item-level-3" data-reactid="153"><a href="/en-us/docs/nacos2-config-benchmark.html" target="_self" data-reactid="154">Nacos2.0 Config Benchmark</a></li><li class="menu-item menu-item-level-3" data-reactid="155"><a href="/en-us/docs/nacos-naming-benchmark.html" target="_self" data-reactid="156">Nacos Naming Benchmark</a></li><li class="menu-item menu-item-level-3" data-reactid="157"><a href="/en-us/docs/nacos2-naming-benchmark.html" target="_self" data-reactid="158">Nacos2.0 Naming Benchmark</a></li><li class="menu-item menu-item-level-3" data-reactid="159"><a href="/en-us/docs/nacos-sync-use.html" target="_self" data-reactid="160">Data Migration to Nacos</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="161"><span data-reactid="162"><!-- react-text: 163 -->Contributor Guide<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="164"/></span><ul data-reactid="165"><li class="menu-item menu-item-level-3" data-reactid="166"><a href="/en-us/docs/contributing.html" target="_self" data-reactid="167">Contribute to Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="168"><a href="/en-us/docs/contributing-flow.html" target="_self" data-reactid="169">Contributing Flow</a></li><li class="menu-item menu-item-level-3" data-reactid="170"><a href="/en-us/docs/pull-request.html" target="_self" data-reactid="171">Pull Request Template</a></li><li class="menu-item menu-item-level-3" data-reactid="172"><a href="/en-us/docs/how-to-reporting-bugs.html" target="_self" data-reactid="173">How to report bugs</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="174"><span data-reactid="175"><!-- react-text: 176 -->Community<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="177"/></span><ul data-reactid="178"><li class="menu-item menu-item-level-3" data-reactid="179"><a href="/en-us/docs/community.html" target="_self" data-reactid="180">Community</a></li><li class="menu-item menu-item-level-3" data-reactid="181"><a href="/en-us/docs/nacos-dev.html" target="_self" data-reactid="182">Develop Team</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body" data-reactid="183"><h1>Nacos 2.0.0-ALPHA2 配置性能测试报告</h1>
<h2>测试目的</h2>
<ol>
<li>长链接各项业务指标的最高值</li>
<li>长链接相比短链接的差异数据对比</li>
</ol>
<h2>测试工具</h2>
<p>我们使用自研的PAS性能评估服务平台进行压测，其原理是基于利用JMeter引擎，使用PAS自动生成的JMeter脚本，进行智能压测。</p>
<p><img src="https://img.alicdn.com/tfs/TB1xCfDDpzqK1RjSZFvXXcB7VXa-692-297.png" alt="Pas图"></p>
<h2>测试环境</h2>
<h3>1.环境</h3>
<table>
<thead>
<tr>
<th><strong>指标</strong></th>
<th><strong>参数</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>机器</td>
<td>CPU 8核，内存16G</td>
</tr>
<tr>
<td>集群规模</td>
<td>单机</td>
</tr>
<tr>
<td>Nacos版本</td>
<td>Nacos 2.0.0-ALPHA2， Nacos 1.4.0</td>
</tr>
<tr>
<td>数据库</td>
<td>32C128G</td>
</tr>
</tbody>
</table>
<p>2.设置启动参数</p>
<p>因为grpc使用的直接内存，堆内存相对使用较少，所以jvm参数有所调整</p>
<h4>Nacos2.0 gRPC</h4>
<pre><code>JAVA_OPT=&quot;${JAVA_OPT} -server -Xms9216m -Xmx9216m  -XX:MaxDirectMemorySize=4096m -XX:NewSize=4096m  -XX:+UnlockDiagnosticVMOptions -XX:+PrintNMTStatistics   -DisPushContent=false -XX:MaxNewSize=4096m -XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=512m -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/admin/nacos/logs/java_heapdump.hprof -XX:-UseLargePages -Xloggc:/home/admin/nacos/logs/nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M -DQUERYTIMEOUT=90  -XX:SurvivorRatio=10 -XX:+UseConcMarkSweepGC -XX:+UseCMSCompactAtFullCollection -XX:+CMSClassUnloadingEnabled -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/admin/nacos/logs -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:CMSMaxAbortablePrecleanTime=5000 -XX:CMSInitiatingOccupancyFraction=74 -XX:+UseCMSInitiatingOccupancyOnly -XX:ParallelGCThreads=8 -Dnacos.core.auth.enabled=false &quot;
</code></pre>
<h4>Nacos1.X HTTP</h4>
<pre><code>-server -Xms12880m -Xmx12880m -XX:MaxDirectMemorySize=1024m -XX:NewSize=1024m -XX:+UnlockDiagnosticVMOptions -XX:+PrintNMTStatistics -DisPushContent=false -XX:MaxNewSize=4096m -XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=512m -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/admin/nacos/logs/java_heapdump.hprof -XX:-UseLargePages -Xloggc:/home/admin/nacos/logs/nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M -DQUERYTIMEOUT=90 -XX:SurvivorRatio=10 -XX:+UseConcMarkSweepGC -XX:+UseCMSCompactAtFullCollection -XX:+CMSClassUnloadingEnabled -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/admin/nacos/logs -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:CMSMaxAbortablePrecleanTime=5000 -XX:CMSInitiatingOccupancyFraction=74 -XX:+UseCMSInitiatingOccupancyOnly -XX:ParallelGCThreads=8 -Dnacos.core.auth.enabled=false -Dnacos.member.list= -Djava.ext.dirs=/opt/taobao/java/jre/lib/ext:/opt/taobao/java/lib/ext -Xloggc:/home/admin/nacos/logs/nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M
</code></pre>
<h2>测试场景</h2>
<p>以下测试场景都是服务配置重要接口：</p>
<ul>
<li>验证Nacos服务发布配置的能力</li>
<li>验证Nacos服务获取配置的能力</li>
<li>验证Nacos服务监听配置的能力</li>
<li>验证Nacos服务长连接容量能力</li>
</ul>
<p>测试方式均是在相同的环境下，使用相同的压力进行测试，分别比对Nacos2.X版本和Nacos1.X版本的性能差异。</p>
<h2>测试数据</h2>
<h3>1. 发布配置</h3>
<h4>Nacos2.0</h4>
<table>
<thead>
<tr>
<th>tps</th>
<th>500</th>
<th>1000</th>
<th>1200</th>
<th>1500</th>
<th>2000</th>
<th>2500</th>
<th>3000</th>
</tr>
</thead>
<tbody>
<tr>
<td>avg rt(ms)</td>
<td>7</td>
<td>8</td>
<td>12</td>
<td>9</td>
<td>9</td>
<td>10.89</td>
<td>1044</td>
</tr>
<tr>
<td>80% rt(ms)</td>
<td>7.9</td>
<td>8</td>
<td>11</td>
<td>9</td>
<td>9</td>
<td>10.69</td>
<td>1581</td>
</tr>
<tr>
<td>95% rt(ms)</td>
<td>8.7</td>
<td>11</td>
<td>25</td>
<td>15</td>
<td>14</td>
<td>24.74</td>
<td>2966</td>
</tr>
<tr>
<td>cpu</td>
<td>12</td>
<td>22</td>
<td>28</td>
<td>36</td>
<td>47</td>
<td>55</td>
<td>62</td>
</tr>
<tr>
<td>load</td>
<td>0.5</td>
<td>1.5</td>
<td>1.5</td>
<td>1.5</td>
<td>3.5</td>
<td>4</td>
<td>5</td>
</tr>
</tbody>
</table>
<h4>Nacos1.X</h4>
<table>
<thead>
<tr>
<th>tps</th>
<th>500</th>
<th>1000</th>
<th>1200</th>
<th>1400</th>
<th>2000</th>
<th>2500</th>
<th>3000</th>
</tr>
</thead>
<tbody>
<tr>
<td>avg rt(ms)</td>
<td>9</td>
<td>8.67</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11.88</td>
<td>1038</td>
</tr>
<tr>
<td>80% rt(ms)</td>
<td>9</td>
<td>9.4</td>
<td>10</td>
<td>9</td>
<td>10</td>
<td>12.48</td>
<td>1090</td>
</tr>
<tr>
<td>95% rt(ms)</td>
<td>11</td>
<td>11.4</td>
<td>12</td>
<td>14</td>
<td>18</td>
<td>25.7</td>
<td>1170</td>
</tr>
<tr>
<td>cpu</td>
<td>14</td>
<td>25</td>
<td>30</td>
<td>35</td>
<td>50</td>
<td>60</td>
<td>65</td>
</tr>
<tr>
<td>load</td>
<td>0.9</td>
<td>1.4</td>
<td>2</td>
<td>2.5</td>
<td>3</td>
<td>2.5</td>
<td>3.7</td>
</tr>
</tbody>
</table>
<h4>结果分析</h4>
<p>发布配置两者差别不大,TPS 在2500tps左右出现拐点,http和长链接通道的cpu消耗分布类似。长链接对发布配置提升不大。</p>
<h3>2. 获取配置</h3>
<p>随机获取200个 5K大小配置</p>
<h4>Nacos2.0</h4>
<table>
<thead>
<tr>
<th>tps</th>
<th>2000</th>
<th>4000</th>
<th>6000</th>
<th>8000</th>
<th>10000</th>
<th>14000</th>
<th>18000（实际15000）</th>
</tr>
</thead>
<tbody>
<tr>
<td>avg rt(ms)</td>
<td>3.3</td>
<td>4</td>
<td>3.5</td>
<td>5</td>
<td>7</td>
<td>26</td>
<td>133</td>
</tr>
<tr>
<td>80% rt(ms)</td>
<td>2.2</td>
<td>2.2</td>
<td>2.5</td>
<td>2.5</td>
<td>4</td>
<td>41</td>
<td>174</td>
</tr>
<tr>
<td>95% rt(ms)</td>
<td>3.3</td>
<td>4.8</td>
<td>5.4</td>
<td>24</td>
<td>38</td>
<td>93</td>
<td>238</td>
</tr>
<tr>
<td>cpu</td>
<td>12</td>
<td>25</td>
<td>37</td>
<td>48</td>
<td>65</td>
<td>83</td>
<td>85</td>
</tr>
<tr>
<td>load</td>
<td>1.2</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>20</td>
<td>36</td>
</tr>
</tbody>
</table>
<h4>Nacos1.X</h4>
<table>
<thead>
<tr>
<th>tps</th>
<th>2000</th>
<th>4000</th>
<th>6000</th>
<th>8000</th>
<th>10000</th>
<th>14000(实际11000)</th>
</tr>
</thead>
<tbody>
<tr>
<td>avg rt(ms)</td>
<td>3</td>
<td>7.4</td>
<td>12</td>
<td>22</td>
<td>46</td>
<td>176</td>
</tr>
<tr>
<td>80% rt(ms)</td>
<td>1.8</td>
<td>2</td>
<td>4</td>
<td>7</td>
<td>35</td>
<td>185</td>
</tr>
<tr>
<td>95% rt(ms)</td>
<td>4.4</td>
<td>6</td>
<td>15</td>
<td>33</td>
<td>118</td>
<td>380</td>
</tr>
<tr>
<td>cpu</td>
<td>15</td>
<td>30</td>
<td>40</td>
<td>52</td>
<td>60</td>
<td>70</td>
</tr>
<tr>
<td>load</td>
<td>1.1</td>
<td>2.2</td>
<td>2.5</td>
<td>4</td>
<td>5.5</td>
<td>9</td>
</tr>
</tbody>
</table>
<h4>结果分析</h4>
<p>长链接支撑的读QPS提升50%，CPU消耗降低50%，http的CPU消耗50%在于请求地址解析</p>
<h3>3. 监听配置</h3>
<p>两者均为单链接监听200配置。</p>
<h4>Nacos2.0</h4>
<table>
<thead>
<tr>
<th>tps</th>
<th>1500</th>
<th>3000</th>
<th>6000</th>
</tr>
</thead>
<tbody>
<tr>
<td>cpu</td>
<td>30</td>
<td>30</td>
<td>60</td>
</tr>
<tr>
<td>ygc</td>
<td>0</td>
<td>3.75s/次，7次 0.5秒</td>
<td>3s/次，10次 1.4秒</td>
</tr>
<tr>
<td>cmsgc</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>load</td>
<td>6</td>
<td>14</td>
<td>20</td>
</tr>
</tbody>
</table>
<h4>Nacos1.X</h4>
<table>
<thead>
<tr>
<th>tps</th>
<th>3000</th>
<th>4000</th>
<th>6000</th>
</tr>
</thead>
<tbody>
<tr>
<td>cpu</td>
<td>80%</td>
<td>90%</td>
<td>80%</td>
</tr>
<tr>
<td>ygc</td>
<td>3s一次，10次耗时0.5s</td>
<td>2s一次，15次耗时1.5s</td>
<td>1.5s一次，20次耗时1.3秒</td>
</tr>
<tr>
<td>cmsgc</td>
<td>3s一次，10次耗时18s</td>
<td>4.5一次，7次耗时10s</td>
<td>7.5s一次，4次耗时5s</td>
</tr>
<tr>
<td>load</td>
<td>6</td>
<td>8</td>
<td>11</td>
</tr>
</tbody>
</table>
<h4>结果分析</h4>
<p>gRPC以1500tps持续变更推送，可以保证系统指标稳定，超过1500tps，系统内存和load持续升高，但完全没有CMS GC，CPU也维持在较低的水准。 Http 则有较高的CMS GC，GC耗时严重，CPU损耗高。</p>
<h3>4. 长连接容量测试</h3>
<p>两者均为单链接监听200配置。快上为同时进行大量配置发布。</p>
<h4>Nacos2.0</h4>
<table>
<thead>
<tr>
<th>count</th>
<th>6000</th>
<th>8000</th>
<th>12000</th>
<th>15000</th>
<th>21000</th>
<th>31500</th>
<th>42000</th>
</tr>
</thead>
<tbody>
<tr>
<td>快上时cpu</td>
<td>40</td>
<td>60</td>
<td>80</td>
<td>77</td>
<td>79</td>
<td>80</td>
<td>74</td>
</tr>
<tr>
<td>快上时load</td>
<td>1.5</td>
<td>3</td>
<td>3.3</td>
<td>3.6</td>
<td>5.45</td>
<td>5.6</td>
<td>6.3</td>
</tr>
<tr>
<td>快上耗时</td>
<td>55s</td>
<td>55s</td>
<td>76</td>
<td>100</td>
<td>80</td>
<td>140</td>
<td>130</td>
</tr>
<tr>
<td>稳定时cpu</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1.3</td>
<td>2.8</td>
<td>1.7</td>
<td>2.1</td>
</tr>
<tr>
<td>稳定时load</td>
<td>0.3</td>
<td>0.5</td>
<td>0.5</td>
<td>0.8</td>
<td>0.9</td>
<td>0.8</td>
<td>0.8</td>
</tr>
<tr>
<td>gc</td>
<td>稳定后无GC消耗</td>
<td>稳定后无GC消耗</td>
<td>稳定后无GC消耗</td>
<td>稳定后无GC消耗</td>
<td>稳定后无GC消耗</td>
<td>稳定后无GC消耗</td>
<td>稳定后无GC消耗</td>
</tr>
</tbody>
</table>
<h4>Nacos1.X</h4>
<table>
<thead>
<tr>
<th>count</th>
<th>6000</th>
<th>8000</th>
<th>12000</th>
<th>15000</th>
<th>21000</th>
<th>31500</th>
<th>42000</th>
</tr>
</thead>
<tbody>
<tr>
<td>快上时cpu</td>
<td>80</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>快上时load</td>
<td>8</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>快上耗时</td>
<td>100s</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>稳定时cpu</td>
<td>60</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>稳定时load</td>
<td>1</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>gc</td>
<td>cmsgc频繁，4秒一次</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<h4>结果分析</h4>
<p>当连接量达到600时，Nacos1.X的CMS GC已经十分严重，4s一次，基本已经达到极限；反观Nacos2.0，可以继续增长，单从支撑长链接数量角度，Nacos2.0比Nacos1.X支撑7倍以上长链接。</p>
<h2>测试结论</h2>
<p>单项基础接口压测</p>
<ul>
<li>Nacos2.0读QPS 14000QPS，对比Nacos1.X QPS 8000 提升75%。</li>
<li>Nacos2.0写TPS 2500TPS，对比Nacos1.X无明显提升。</li>
<li>Nacos2.0支撑长链接40000以上，对比Nacos1.X提升7倍以上。</li>
<li>Nacos2.0变更推送1500/s, 对比Nacos1.X无明显提升。</li>
</ul>
<p><strong>注意</strong></p>
<ul>
<li>本测试为对比Nacos1.X版本的测试场景，仅测试单核心接口的能力值，<strong>真实模拟场景压测</strong> 将在后续版本给出；</li>
<li>本测试供给大家作为参考，如有不足或偏差，请指正! 如果对性能有其他需求，可以给我们提issue。</li>
</ul>
</div></div></section><footer class="footer-container" data-reactid="184"><div class="footer-body" data-reactid="185"><img src="/img/nacos_gray.png" data-reactid="186"/><div class="cols-container" data-reactid="187"><div class="col col-12" data-reactid="188"><h3 data-reactid="189">Vision</h3><p data-reactid="190">By providing an easy-to-use service infrastructure such as dynamic service discovery, service configuration, service sharing and management and etc., Nacos help users better construct, deliver and manage their own service platform, reuse and composite business service faster and deliver value of business innovation more quickly so as to win market for users in the era of cloud native and in all cloud environments, such as private, mixed, or public clouds.</p></div><div class="col col-6" data-reactid="191"><dl data-reactid="192"><dt data-reactid="193">Documentation</dt><dd data-reactid="194"><a href="/en-us/docs/what-is-nacos.html" target="_self" data-reactid="195">Overview</a></dd><dd data-reactid="196"><a href="/en-us/docs/quick-start.html" target="_self" data-reactid="197">Quick start</a></dd><dd data-reactid="198"><a href="/en-us/docs/contributing.html" target="_self" data-reactid="199">Developer guide</a></dd></dl></div><div class="col col-6" data-reactid="200"><dl data-reactid="201"><dt data-reactid="202">Resources</dt><dd data-reactid="203"><a href="/en-us/community/index.html" target="_self" data-reactid="204">Community</a></dd><dd data-reactid="205"><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target="_self" data-reactid="206">Cloud Service MSE</a></dd><dd data-reactid="207"><a href="https://www.aliyun.com/product/edas?source_type=nacos_pc_20181219" target="_self" data-reactid="208">Cloud Service EDAS</a></dd><dd data-reactid="209"><a href="https://www.aliyun.com/product/ahas?source_type=nacos_pc_20190225" target="_self" data-reactid="210">Cloud Service AHAS</a></dd></dl></div></div><div class="copyright" data-reactid="211"><span data-reactid="212">@ 2022 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js">
	</script>
	<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e3a5cec56ef8619cf9d7c2abebd509e3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
</body>
</html>