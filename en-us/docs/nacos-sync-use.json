{
  "filename": "nacos-sync-use.md",
  "__html": "<h1>NacosSync migration user guide</h1>\n<h2>Guide purposes</h2>\n<ul>\n<li>Start NacosSync service</li>\n<li>By a simple example, demonstrates how to register to the Zookeeper Dubbo client migrated to Nacos.</li>\n</ul>\n<h2>Preparatory work</h2>\n<p>Before you start the service, you need to install the following services:</p>\n<ul>\n<li>64bit OS: Linux/Unix/Mac/Windows supported, Linux/Unix/Mac recommended.</li>\n<li>64bit JDK 1.8+: <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html\">downloads</a>, <a href=\"https://docs.oracle.com/cd/E19182-01/820-7851/inst_cli_jdk_javahome_t/\">JAVA_HOME settings</a>.</li>\n<li>Maven 3.2.x+: <a href=\"https://maven.apache.org/download.cgi\">downloads</a>, <a href=\"https://maven.apache.org/settings.html\">settings</a>.</li>\n<li>MySql 5.6.+</li>\n</ul>\n<h2>Get the installation package</h2>\n<p>There are two ways to obtain NacosSync installation package:</p>\n<ul>\n<li>Direct download NacosSync binary installation package:<a href=\"https://github.com/nacos-group/nacos-sync/releases\">nacosSync.${version}.zip</a></li>\n<li>Download NacosSync source to build from the Github</li>\n</ul>\n<p>Package:</p>\n<pre><code class=\"language-basic\">cd nacosSync/\nmvn clean package -U\n</code></pre>\n<p>The path of the target file:</p>\n<pre><code class=\"language-basic\">nacos-sync/nacossync-distribution/target/nacosSync.${version}.zip\n</code></pre>\n<p>Unpack the installation package, project file directory structure:</p>\n<pre><code class=\"language-basic\">nacosSync\n├── LICENSE\n├── NOTICE\n├── bin\n│   ├── nacosSync.sql\n│   ├── shutdown.sh\n│   └── startup.sh\n├── conf\n│   ├── application.properties\n│   └── logback-spring.xml\n├── logs\n└── nacosSync-server.${version}.jar\n</code></pre>\n<h2>Initialize the database</h2>\n<p>The system default configuration database is Mysql, can also support other relational database.\n1.The database construction, the default database name for &quot;nacos_Sync&quot;.\n2.The database table don't need to create separately, using the hibernate automatically by default build table function.\n3.If you do not support automatic table, you can use the system's own build table SQL script, the script in the bin directory.</p>\n<h2>Database configuration</h2>\n<p>Database configuration file on <code>conf/application.properties</code>:</p>\n<pre><code class=\"language-basic\">spring.datasource.url=jdbc:mysql://127.0.0.1:3306/nacos_sync?characterEncoding=utf8\nspring.datasource.username=root\nspring.datasource.password=root\n</code></pre>\n<h2>Start server</h2>\n<pre><code class=\"language-bash\">$ nacosSync/bin:\nsh startup.sh  restart\n</code></pre>\n<h2>Check system status</h2>\n<p>1.Check system log</p>\n<p>The path of the log in <code>nacosSync/logs/nacosSync.log</code>, check whether there are abnormal information.</p>\n<p>2.Check system port</p>\n<p>Port is the default system <code>8081</code>, you can define your own <code>application.properties</code>.</p>\n<pre><code class=\"language-bash\"><span class=\"hljs-variable\">$netstat</span> -ano|grep 8081\ntcp        0      0 0.0.0.0:8081                0.0.0.0:*                   LISTEN      off (0.00/0/0)\n</code></pre>\n<h2>Console</h2>\n<p>Access path:</p>\n<pre><code>http://127.0.0.1:8081/#/serviceSync\n</code></pre>\n<p><img src=\"https://img.alicdn.com/tfs/TB1EKbkJ3HqK1RjSZFEXXcGMXXa-2866-606.png\" alt=\"image.png\"></p>\n<p>If there is no problem, check NacosSync has begun, normal NacosSync deployment structure:<img src=\"https://img.alicdn.com/tfs/TB107nfJ9zqK1RjSZFjXXblCFXa-1412-342.png\" alt=\"image.png\"></p>\n<h2>Starting migration</h2>\n<h3>Migration information</h3>\n<p>Dubbo service deployment information:<img src=\"https://img.alicdn.com/tfs/TB1Ci_eJ4TpK1RjSZR0XXbEwXXa-938-700.png\" alt=\"image.png\"></p>\n<p>The migration of services:</p>\n<table>\n<thead>\n<tr>\n<th>Service Name</th>\n<th>Version</th>\n<th>Group Name</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>com.alibaba.nacos.api.DemoService</td>\n<td>1.0.0</td>\n<td>zk</td>\n</tr>\n</tbody>\n</table>\n<h3>Add the registry cluster information</h3>\n<p>1.Click on the &quot;cluster configuration&quot; button in the left navigation bar, a new cluster, first add a Zookeeper cluster, select the cluster type for ZK.\n<img src=\"https://img.alicdn.com/tfs/TB1oJDnJ7voK1RjSZFwXXciCFXa-2870-1130.png\" alt=\"image.png\"></p>\n<blockquote>\n<p>Note: the cluster name can customize, but once confirmed, cannot be modified, otherwise increase task based on the cluster, after NacosSync restart, success will not resume.</p>\n</blockquote>\n<p>2.The same steps, increase NacosSync cluster.\n<img src=\"https://img.alicdn.com/tfs/TB1HQPhJVzqK1RjSZFCXXbbxVXa-2846-1042.png\" alt=\"image.png\"></p>\n<p>3.After the completion of the add, can inquire on the list:\n<img src=\"https://img.alicdn.com/tfs/TB1AX6fJVYqK1RjSZLeXXbXppXa-2864-824.png\" alt=\"image.png\"></p>\n<h3>Add the synchronization task</h3>\n<ol>\n<li>Add a sync task, from Zookeeper cluster synchronization to Nacos cluster, synchronous granularity is service, it is called a Zookeeper cluster source cluster, Nacos cluster called target cluster.\n<img src=\"https://img.alicdn.com/tfs/TB1tF_fJVYqK1RjSZLeXXbXppXa-2838-1138.png\" alt=\"imagesd.png\"></li>\n</ol>\n<p>Add finished, can be in service sync list, view has add synchronization task:\n<img src=\"https://img.alicdn.com/tfs/TB1l6uJJ9zqK1RjSZPcXXbTepXa-2824-570.png\" alt=\"image.png\"></p>\n<ol start=\"2\">\n<li>\n<p>The synchronization is completed, check whether the data synchronization to success Nacos cluster, can query through the Nacos console.\n<img src=\"https://img.alicdn.com/tfs/TB1tPneJ4TpK1RjSZR0XXbEwXXa-2872-828.png\" alt=\"image.png\"></p>\n</li>\n<li>\n<p>At the moment, the data has been successfully from Zookeeper cluster synchronization to Nacos cluster, the deployment structure is as follows:\n<img src=\"https://img.alicdn.com/tfs/TB14kriJ6TpK1RjSZKPXXa3UpXa-1724-772.png\" alt=\"image.png\"></p>\n</li>\n</ol>\n<h3>Dubbo clients to connect to Nacos registry</h3>\n<h4>Dubbo Consumer client migration</h4>\n<p>Dubbo has supported Nacos registry, support version 2.5 +, need to add a Nacos registry of Dubbo extensions depends on:</p>\n<pre><code class=\"language-basic\">&lt;dependency&gt;\n      &lt;groupId&gt;com.alibaba&lt;/groupId&gt;\n      &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;\n\t\t\t&lt;version&gt;0.0.2&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>Increase Nacos client depends on:</p>\n<pre><code class=\"language-basic\">&lt;dependency&gt;\n        &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;\n        &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;\n        &lt;version&gt;0.6.2&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>Configuration Dubbo Consumer Dubbo profile <code>Consumer. The yaml</code>, let the client can find Nacos cluster.</p>\n<pre><code class=\"language-basic\">spring:\n  application:\nname: dubbo-consumer\ndemo:\n  service:\n    version: 1.0.0\n    group: zk\ndubbo:\n  registry:\n    address: nacos://127.0.0.1:8848\n</code></pre>\n<p>Don't need to modify the code, configuration after the update, you can restart your application into law.</p>\n<p>Consumer release is completed, the deployment of the structure is as follows:\n<img src=\"https://img.alicdn.com/tfs/TB181fkJ3HqK1RjSZFEXXcGMXXa-1734-878.png\" alt=\"image.png\"></p>\n<h4>Dubbo Provider migration</h4>\n<p>Before you upgrade the Provider, you need to ensure that the Provider of services, are already configured in NacosSync, synchronous way from Nacos synchronization to Zookeeper, because the Provider connected to Nacos upgrade, you need to make sure that the old Dubbo Consumer client can subscribe to the Provider's address in the Zookeeper, now, we add a sync task:\n<img src=\"https://img.alicdn.com/tfs/TB1pdDnJ7voK1RjSZFwXXciCFXa-2872-1060.png\" alt=\"image.png\"></p>\n<p><img src=\"https://img.alicdn.com/tfs/TB19Ey_J6DpK1RjSZFrXXa78VXa-2842-660.png\" alt=\"image.png\"></p>\n<blockquote>\n<p>Note: Nacos synchronization to the Zookeeper service, do not need to fill in the version number, you in choosing the source cluster, the version number of the input box automatically hidden.</p>\n</blockquote>\n<p>Sync task is completed, you can upgrade the Provider, upgrade the Provider method, reference to upgrade the Consumer steps.</p>\n<h3>New deployment structure</h3>\n<ul>\n<li>In the process of upgrading, there will be new and old versions of the client at the same time, the deployment structure is as follows:</li>\n</ul>\n<p><img src=\"https://img.alicdn.com/tfs/TB14Y_iJ3HqK1RjSZFPXXcwapXa-1728-838.png\" alt=\"image.png\"></p>\n<ul>\n<li>All client migration is completed, the deployment structure is as follows:</li>\n</ul>\n<p><img src=\"https://img.alicdn.com/tfs/TB1Cg2dJYvpK1RjSZPiXXbmwXXa-1466-864.png\" alt=\"image.png\"></p>\n<p>Now, the Zookeeper cluster, NacosSync cluster can get offline.</p>\n<h3>Attention</h3>\n<ul>\n<li>Synchronization task after adding, you need to ensure that the service is successful sync to the target cluster, can through the console the target cluster.</li>\n<li>NacosSync support high availability cluster pattern deployment, you only need to put the database can be configured to the same.</li>\n<li>Comb if not clear subscription and published service, suggested can do services are two-way synchronous.</li>\n<li>Dubbo client currently does not support Nacos weighting function, if you are using the weight function, need to reconsider the plan.</li>\n</ul>\n",
  "link": "/en-us/docs/nacos-sync-use.html",
  "meta": {
    "title": "NacosSync migration user guide",
    "keywords": "NacosSync,migration,user guide",
    "description": "NacosSync migration user manual"
  }
}