{
  "filename": "auth.md",
  "__html": "<blockquote>\n<p>Attention</p>\n<ul>\n<li>Nacos is an internal micro service component, which needs to run in a trusted internal network. It can not be exposed to the public network environment to prevent security risks.</li>\n<li>Nacos provides a simple authentication implementation. It is a weak authentication system to prevent business misuse, not a strong authentication system to prevent malicious attacks.</li>\n<li>If you are running in an untrusted network environment or have strong authentication demands, please refer to the official simple implementation for replacement and enhancement.</li>\n</ul>\n</blockquote>\n<h1>Authentication</h1>\n<h2>Use Authentication in Servers</h2>\n<h3>Without Docker</h3>\n<p>By default, no login is required to start following the official document configuration, which can expose the configuration center directly to the outside world. However, if the authentication is enabled, one can use nacos only after he configures the user name and password.</p>\n<p>Before enabling authentication, the configuration in application.properties is as follow:</p>\n<pre><code class=\"language-java\">### If turn on auth system:\nnacos.core.auth.enabled=false\n</code></pre>\n<p>After enabling authentication, the configuration in application.properties is as follow:</p>\n<pre><code class=\"language-java\">### If turn on auth system:\nnacos.core.auth.enabled=true\n</code></pre>\n<h3>With Docker</h3>\n<h4>Official images</h4>\n<p>If you choose to use official images, please add the following environment parameter when you start a docker container.</p>\n<pre><code class=\"language-powershell\">NACOS_AUTH_ENABLE=true\n</code></pre>\n<p>For example, you can run this command to run a docker container with Authentication:</p>\n<pre><code class=\"language-powershell\">docker run -<span class=\"hljs-literal\">-env</span> PREFER_HOST_MODE=hostname -<span class=\"hljs-literal\">-env</span> MODE=standalone -<span class=\"hljs-literal\">-env</span> NACOS_AUTH_ENABLE=true <span class=\"hljs-literal\">-p</span> <span class=\"hljs-number\">8848</span>:<span class=\"hljs-number\">8848</span> nacos/nacos<span class=\"hljs-literal\">-server</span>\n</code></pre>\n<p>Besides, you can also add the other related enviroment parameters:</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>description</th>\n<th>option</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NACOS_AUTH_ENABLE</td>\n<td>If turn on auth system</td>\n<td>default :false</td>\n</tr>\n<tr>\n<td>NACOS_AUTH_TOKEN_EXPIRE_SECONDS</td>\n<td>The token expiration in seconds</td>\n<td>default :18000</td>\n</tr>\n<tr>\n<td>NACOS_AUTH_TOKEN</td>\n<td>The default token</td>\n<td>default :SecretKey012345678901234567890123456789012345678901234567890123456789</td>\n</tr>\n<tr>\n<td>NACOS_AUTH_CACHE_ENABLE</td>\n<td>Turn on/off caching of auth information. By turning on this switch, the update of auth information would have a 15 seconds delay.</td>\n<td>default : false</td>\n</tr>\n</tbody>\n</table>\n<h4>Custom images</h4>\n<p>If you choose to use custom images, please modify the application.properties before you start nacos, change this line</p>\n<pre><code>nacos.core.auth.enabled=false\n</code></pre>\n<p>into</p>\n<pre><code>nacos.core.auth.enabled=true\n</code></pre>\n<h2>Authentication in Clients</h2>\n<h3>Authentication in Java SDK</h3>\n<p>The user name and password should be set when creating a 'Properties' class.</p>\n<pre><code class=\"language-java\">properties.put(<span class=\"hljs-string\">\"username\"</span>,<span class=\"hljs-string\">\"${username}\"</span>);\nproperties.put(<span class=\"hljs-string\">\"password\"</span>,<span class=\"hljs-string\">\"${password}\"</span>);\n</code></pre>\n<h4>Example Code</h4>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">try</span> {\n    <span class=\"hljs-comment\">// Initialize the configuration service, and the console automatically obtains the following parameters through the sample code.</span>\n\tString serverAddr = <span class=\"hljs-string\">\"{serverAddr}\"</span>;\n\tProperties properties = <span class=\"hljs-keyword\">new</span> Properties();\n\tproperties.put(<span class=\"hljs-string\">\"serverAddr\"</span>, serverAddr);\n\n    <span class=\"hljs-comment\">// if need username and password to login</span>\n        properties.put(<span class=\"hljs-string\">\"username\"</span>,<span class=\"hljs-string\">\"nacos\"</span>);\n        properties.put(<span class=\"hljs-string\">\"password\"</span>,<span class=\"hljs-string\">\"nacos\"</span>);\n\n\tConfigService configService = NacosFactory.createConfigService(properties);\n} <span class=\"hljs-keyword\">catch</span> (NacosException e) {\n    <span class=\"hljs-comment\">// TODO Auto-generated catch block</span>\n    e.printStackTrace();\n}\n</code></pre>\n<h3>Authentication in Other languages SDK</h3>\n<p>Pending...</p>\n<h3>Authentication in Open-API</h3>\n<p>Firstly, the user name and password should be provided to login.</p>\n<pre><code class=\"language-plain\">curl -X POST '127.0.0.1:8848/nacos/v1/auth/login' -d 'username=nacos&amp;password=nacos'\n</code></pre>\n<p>If the user name and password are correct, the response will be:</p>\n<pre><code>{&quot;accessToken&quot;:&quot;eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTYwNTYyOTE2Nn0.2TogGhhr11_vLEjqKko1HJHUJEmsPuCxkur-CfNojDo&quot;,&quot;tokenTtl&quot;:18000,&quot;globalAdmin&quot;:true}\n</code></pre>\n<p>Secondly, when using configuration services or naming services, accessToken in the previous response should be provided. To use the accessToken, 'accessToken=${accessToken}' should be appended at the end of request url, e.g.,</p>\n<pre><code class=\"language-plain\">curl -X GET '127.0.0.1:8848/nacos/v1/cs/configs?accessToken=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTYwNTYyMzkyM30.O-s2yWfDSUZ7Svd3Vs7jy9tsfDNHs1SuebJB4KlNY8Q&amp;dataId=nacos.example.1&amp;group=nacos_group'\n</code></pre>\n<pre><code class=\"language-plain\">curl -X POST 'http://127.0.0.1:8848/nacos/v1/ns/instance?accessToken=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTYwNTYyMzkyM30.O-s2yWfDSUZ7Svd3Vs7jy9tsfDNHs1SuebJB4KlNY8Q&amp;port=8848&amp;healthy=true&amp;ip=11.11.11.11&amp;weight=1.0&amp;serviceName=nacos.test.3&amp;encoding=GBK&amp;namespaceId=n1'\n</code></pre>\n<h2>Open feature for server identity</h2>\n<p>After the authentication feature is enabled, requests between servers will also be affected by the authentication system. Considering that the communication between the servers should be credible, during the 1.2~1.4.0 version, Nacos server use whether the User-Agent includes Nacos-Server to determine whether the request comes from other servers.</p>\n<p>However, this implementation is too simple and fixed, leading to possible security issues. Therefore, since version 1.4.1, Nacos has added the server identification feature. Users can configure the identity of the server by themselves, and no longer use User-Agent as the judgment standard for server requests.</p>\n<p>Way to open server identity</p>\n<pre><code>### Open authentication\nnacos.core.auth.enabled=true\n\n### Shutdown user-agent judgement for server request\nnacos.core.auth.enable.userAgentAuthWhite=false\n\n### Config the server identity key(not empty) and value(not empty)\nnacos.core.auth.server.identity.key=example\nnacos.core.auth.server.identity.value=example\n</code></pre>\n<p>** Attention ** All servers in cluster need to be configured with the same <code>server.identity</code> information, otherwise it may cause data inconsistency between servers or failure to delete instances.</p>\n<h3>Upgrade from old version</h3>\n<p>Considering that users of the old version need to upgrade, users can turn on the <code>nacos.core.auth.enable.userAgentAuthWhite=true</code> during upgrading, and turn off it after the cluster is upgraded to 1.4.1 completely and runs stably.</p>\n",
  "link": "/en-us/docs/auth.html",
  "meta": {
    "title": "Authentication",
    "keywords": "Authentication",
    "description": "Authentication"
  }
}