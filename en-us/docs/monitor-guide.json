{
  "filename": "monitor-guide.md",
  "__html": "<h1>Nacos monitor guide</h1>\n<p>Nacos 0.8.0 improves the monitoring system, supporting Nacos operation status monitoring through exposing metrics data access to third-party monitoring system. Currently, prometheus, elastic search and influxdb are supported. The docs introduce how prometheus and grafana monitor Nacos.\nHere is Nacos <a href=\"http://monitor.nacos.io\">grafana monitoring page</a>. You can find out for yourself how to use elastic search and influxdb.</p>\n<h2>Deploy Nacos cluster to expose metrics data</h2>\n<p>Deploy the Nacos cluster according to <a href=\"https://nacos.io/en-us/docs/deployment.html\">the deploy document</a></p>\n<p>Configure the application. properties file to expose metrics data</p>\n<pre><code>management.endpoints.web.exposure.include=*\n</code></pre>\n<p>Access {ip}:8848/nacos/actuator/prometheus to see if metrics data can be accessed</p>\n<h2>Deploy prometheus to collect Nacos metrics data</h2>\n<p>Download the Prometheus version you want to install at the address of <a href=\"https://prometheus.io/download/\">download prometheus</a></p>\n<h3>linux &amp; mac</h3>\n<p>Decompress prometheus compression package</p>\n<pre><code>tar xvfz prometheus-*.tar.gz\ncd prometheus-*\n</code></pre>\n<p>Modify configuration file prometheus.yml to collect Nacos metrics data</p>\n<pre><code>    metrics_path: '/nacos/actuator/prometheus'\n    static_configs:\n      - targets: ['{ip1}:8848','{ip2}:8848','{ip3}:8848']\n</code></pre>\n<p>Start prometheus service</p>\n<pre><code>./prometheus --config.file=&quot;prometheus.yml&quot;\n</code></pre>\n<h3>windows</h3>\n<p>Download the corresponding version of Windows and decompress it</p>\n<p>Modify configuration file prometheus.yml to collect Nacos metrics data</p>\n<pre><code>    metrics_path: '/nacos/actuator/prometheus'\n    static_configs:\n      - targets:['{ip1}:8848','{ip2}:8848','{ip3}:8848']\n</code></pre>\n<p>Start prometheus service</p>\n<pre><code>prometheus.exe --config.file=prometheus.yml\n</code></pre>\n<p>By accessing http://{ip}:9090/graph, we can see the data collected by prometheus. By searching nacos_monitor in the search bar, we can find Nacos data to show the success of the data collection.\n<img src=\"https://img.alicdn.com/tfs/TB1LThVCQvoK1RjSZFwXXciCFXa-2832-1576.png\" alt=\"IMAGE\"></p>\n<h2>Deploy grafana to graphically display metrics data</h2>\n<p>Install grafana on the same machine as prometheus, and use yum to install grafana</p>\n<h3>mac</h3>\n<pre><code>brew install grafana\nbrew services start grafana\n</code></pre>\n<h3>linux</h3>\n<pre><code>sudo yum install https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana-5.2.4-1.x86_64.rpm\nsudo service grafana-server start\n</code></pre>\n<h3>windows</h3>\n<p>Reference documentï¼š<a href=\"http://docs.grafana.org/installation/windows/\">http://docs.grafana.org/installation/windows/</a></p>\n<p>Access grafana: http://{ip}:3000</p>\n<p>Configuring prometheus data source\n<img src=\"https://img.alicdn.com/tfs/TB1bTafCOLaK1RjSZFxXXamPFXa-2832-1568.png\" alt=\"IMAGE\"></p>\n<p>Import Nacos grafana monitoring <a href=\"https://github.com/nacos-group/nacos-template/blob/master/nacos-grafana.json\">template</a>\n<img src=\"https://img.alicdn.com/tfs/TB1JadVCPDpK1RjSZFrXXa78VXa-2742-1338.png\" alt=\"IMAGE\"></p>\n<p>Nacos monitoring is divided into three modules:</p>\n<ul>\n<li>nacos monitor shows core monitoring items\n<img src=\"https://img.alicdn.com/tfs/TB1PMpUCQvoK1RjSZFDXXXY3pXa-2832-1584.png\" alt=\"IMAGE\"></li>\n<li>nacos detail shows the change curve of index\n<img src=\"https://img.alicdn.com/tfs/TB1ZBF4CNjaK1RjSZFAXXbdLFXa-2742-1480.png\" alt=\"IMAGE\"></li>\n<li>nacos alert is alerts about nacos\n<img src=\"https://img.alicdn.com/tfs/TB1ALlUCFzqK1RjSZFCXXbbxVXa-2742-1476.png\" alt=\"IMAGE\"></li>\n</ul>\n<h2>configure grafana alert</h2>\n<p>When Nacos runs out of order, Grafana can alert the person in charge. Grafana supports a variety of police alert. Mail, DingTalk and webhook are commonly used.</p>\n<h3>DingTalk alert</h3>\n<p>Configure DingTalk robots\n<img src=\"https://img.alicdn.com/tfs/TB1eJ0RCSzqK1RjSZFjXXblCFXa-2742-1482.png\" alt=\"IMAGE\"></p>\n<p>Configure DingTalk robots url\n<img src=\"https://img.alicdn.com/tfs/TB1ERtQCSzqK1RjSZFjXXblCFXa-2832-1578.png\" alt=\"IMAGE\"></p>\n<p>Test alert\n<img src=\"https://img.alicdn.com/tfs/TB1KvXPCHPpK1RjSZFFXXa5PpXa-996-504.png\" alt=\"IMAGE\"></p>\n<h3>mail alert</h3>\n<p>Modify defaults.ini configuration file to add mail alerts</p>\n<pre><code>#################################### SMTP / Emailing ##########################\n[smtp]\nenabled = true\nhost = smtp.126.com:25\nuser = xxxxxx\npassword = xxxxx\n;cert_file =\n;key_file =\nskip_verify = true\nfrom_address = xxxxxx@126.com\n\n[emails]\n;welcome_email_on_sign_up = false\n</code></pre>\n<p>Configuration notification mailbox\n<img src=\"https://img.alicdn.com/tfs/TB12qyhCNnaK1RjSZFtXXbC2VXa-2832-1576.png\" alt=\"IMAGE\"></p>\n<h2>meaning of Nacos metrics</h2>\n<h3>jvm metrics</h3>\n<table>\n<thead>\n<tr>\n<th>item</th>\n<th>meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>system_cpu_usage</td>\n<td>cpu usage</td>\n</tr>\n<tr>\n<td>system_load_average_1m</td>\n<td>load</td>\n</tr>\n<tr>\n<td>jvm_memory_used_bytes</td>\n<td>jvm memory used(bytes)</td>\n</tr>\n<tr>\n<td>jvm_memory_max_bytes</td>\n<td>jvm memory max(bytes)</td>\n</tr>\n<tr>\n<td>jvm_gc_pause_seconds_count</td>\n<td>gc count</td>\n</tr>\n<tr>\n<td>jvm_gc_pause_seconds_sum</td>\n<td>gc time</td>\n</tr>\n<tr>\n<td>jvm_threads_daemon</td>\n<td>jvm threads count</td>\n</tr>\n</tbody>\n</table>\n<h3>Nacos metrics</h3>\n<table>\n<thead>\n<tr>\n<th>item</th>\n<th>meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>http_server_requests_seconds_count</td>\n<td>http requests count</td>\n</tr>\n<tr>\n<td>http_server_requests_seconds_sum</td>\n<td>http requests time</td>\n</tr>\n<tr>\n<td>nacos_timer_seconds_sum</td>\n<td>Nacos config notify time</td>\n</tr>\n<tr>\n<td>nacos_timer_seconds_count</td>\n<td>Nacos config notify count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='longPolling'}</td>\n<td>Nacos config connection count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='configCount'}</td>\n<td>Nacos configuration file count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='dumpTask'}</td>\n<td>Nacos config dump task count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='notifyTask'}</td>\n<td>Nacos config notify task count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='getConfig'}</td>\n<td>Nacos config read configuration count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='publish'}</td>\n<td>Nacos config update configuration count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='ipCount'}</td>\n<td>Nacos naming ip count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='domCount'}</td>\n<td>Nacos naming domain count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='failedPush'}</td>\n<td>Nacos naming push fail count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='avgPushCost'}</td>\n<td>Nacos naming push cost time(average)</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='leaderStatus'}</td>\n<td>Nacos naming if node is leader</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='maxPushCost'}</td>\n<td>Nacos naming push cost time(max)</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='mysqlhealthCheck'}</td>\n<td>Nacos naming mysql health check count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='httpHealthCheck'}</td>\n<td>Nacos naming http health check count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='tcpHealthCheck'}</td>\n<td>Nacos naming tcp health check count</td>\n</tr>\n</tbody>\n</table>\n<h3>nacos exception</h3>\n<table>\n<thead>\n<tr>\n<th>item</th>\n<th>meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>nacos_exception_total{name='db'}</td>\n<td>database exception</td>\n</tr>\n<tr>\n<td>nacos_exception_total{name='configNotify'}</td>\n<td>Nacos config notify exception</td>\n</tr>\n<tr>\n<td>nacos_exception_total{name='unhealth'}</td>\n<td>Nacos config server health check exception</td>\n</tr>\n<tr>\n<td>nacos_exception_total{name='disk'}</td>\n<td>Nacos naming write disk exception</td>\n</tr>\n<tr>\n<td>nacos_exception_total{name='leaderSendBeatFailed'}</td>\n<td>Nacos naming leader send heart beat fail count</td>\n</tr>\n<tr>\n<td>nacos_exception_total{name='illegalArgument'}</td>\n<td>request argument illegal count</td>\n</tr>\n<tr>\n<td>nacos_exception_total{name='nacos'}</td>\n<td>Nacos inner exception</td>\n</tr>\n</tbody>\n</table>\n<h3>client metrics</h3>\n<table>\n<thead>\n<tr>\n<th>item</th>\n<th>meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>nacos_monitor{name='subServiceCount'}</td>\n<td>subscribed services count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='pubServiceCount'}</td>\n<td>published services count</td>\n</tr>\n<tr>\n<td>nacos_monitor{name='configListenSize'}</td>\n<td>listened configuration file count</td>\n</tr>\n<tr>\n<td>nacos_client_request_seconds_count</td>\n<td>request count</td>\n</tr>\n<tr>\n<td>nacos_client_request_seconds_sum</td>\n<td>request time</td>\n</tr>\n</tbody>\n</table>\n<h2>Nacos-Sync monitor</h2>\n<p>With the release of Nacos 0.9, Nacos-Sync 0.3 supports metrics monitoring. It can observe the running status of Nacos-Sync service through metrics data, and improve the monitoring capability of Nacos-Sync in production environment.\nReference for the Construction of the Overall Monitoring System <a href=\"https://nacos.io/en-us/docs/monitor-guide.html\">Nacos Monitoring Manual</a></p>\n<h2>grafana monitor Nacos-Sync</h2>\n<p>The same as Nacos monitoring, Nacos-Sync also provides monitoring templates to import monitoring <a href=\"https://github.com/nacos-group/nacos-template/blob/master/nacos-sync-grafana\">Nacos-Sync templates</a></p>\n<p>Nacos-Sync monitoring is also divided into three modules:</p>\n<ul>\n<li>nacos-sync monitor shows core monitoring items\n<img src=\"https://img.alicdn.com/tfs/TB1GeNWKmzqK1RjSZFHXXb3CpXa-2834-1588.png\" alt=\"monitor\"></li>\n<li>nacos-sync detail and alert shows monitoring curves and alarms.\n<img src=\"https://img.alicdn.com/tfs/TB1kP8UKbvpK1RjSZPiXXbmwXXa-2834-1570.png\" alt=\"detail\"></li>\n</ul>\n<h2>Nacos-Sync metrics meaning</h2>\n<p>Nacos-Sync metrics is divided into JVM layer and application layer</p>\n<h3>jvm metrics</h3>\n<table>\n<thead>\n<tr>\n<th>item</th>\n<th>meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>system_cpu_usage</td>\n<td>cpu usage</td>\n</tr>\n<tr>\n<td>system_load_average_1m</td>\n<td>load</td>\n</tr>\n<tr>\n<td>jvm_memory_used_bytes</td>\n<td>jvm memory used(bytes)</td>\n</tr>\n<tr>\n<td>jvm_memory_max_bytes</td>\n<td>jvm memory max(bytes)</td>\n</tr>\n<tr>\n<td>jvm_gc_pause_seconds_count</td>\n<td>gc count</td>\n</tr>\n<tr>\n<td>jvm_gc_pause_seconds_sum</td>\n<td>gc time</td>\n</tr>\n<tr>\n<td>jvm_threads_daemon</td>\n<td>jvm threads count</td>\n</tr>\n</tbody>\n</table>\n<h2>application metrics</h2>\n<table>\n<thead>\n<tr>\n<th>item</th>\n<th>meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>nacosSync_task_size</td>\n<td>sync task count</td>\n</tr>\n<tr>\n<td>nacosSync_cluster_size</td>\n<td>cluster count</td>\n</tr>\n<tr>\n<td>nacosSync_add_task_rt</td>\n<td>add task time</td>\n</tr>\n<tr>\n<td>nacosSync_delete_task_rt</td>\n<td>delete task time</td>\n</tr>\n<tr>\n<td>nacosSync_dispatcher_task</td>\n<td>dispatcher task time</td>\n</tr>\n<tr>\n<td>nacosSync_sync_task_error</td>\n<td>sync task error count</td>\n</tr>\n</tbody>\n</table>\n",
  "link": "/en-us/docs/monitor-guide.html",
  "meta": {
    "title": "Nacos monitor guide",
    "keywords": "Nacos,monitor guide",
    "description": "Nacos monitor guide"
  }
}