{
  "filename": "config-encryption.md",
  "__html": "<blockquote>\n<p>为保证用户敏感配置数据的安全，Nacos 提供了配置加密的新特性。降低了用户使用的风险，也不需要再对配置进行单独的加密处理。</p>\n</blockquote>\n<h1>前提条件</h1>\n<p><strong>版本:</strong></p>\n<p>老版本暂时不兼容，目前只基于2.x版本进行了改造，推荐版本 &gt; 2.0.4。</p>\n<p><strong>内嵌数据库启动:</strong></p>\n<p>数据库表 config_info、config_info_beta、his_config_info中需要新增字段 <code>encrypted_data_key</code> ，用来存储每一个配置项加密使用的秘钥。新版本的默认创建表的sql中已经添加该字段。</p>\n<p>如果之前使用过内嵌数据库的单机模式启动，则需要删除 nacos/data 文件夹，在重新启动会重新创建表。</p>\n<p><strong>MySQL启动:</strong></p>\n<p>数据库表 config_info、config_info_beta、his_config_info中需要新增字段 <code>encrypted_data_key</code> ，用来存储每一个配置项加密使用的秘钥。新版本的默认创建表的sql中已经添加该字段。</p>\n<blockquote>\n<p>对于目前已经搭建好的 Nacos 使用以下 sql 将字段添加到对应的表中：</p>\n<p><code>ALTER TABLE table_name ADD COLUMN `encrypted_data_key` text NOT NULL COMMENT '秘钥'</code></p>\n</blockquote>\n<h1>插件化实现</h1>\n<p><img src=\"https://tva1.sinaimg.cn/large/008i3skNly1gvsu112vnnj314b0u0764.jpg\" alt=\"\"></p>\n<p>通过 SPI 的机制抽象出加密和解密的操作，Nacos 默认提供 <code>AES</code> 的实现。用户也可以自定义加解密的实现方式。具体的实现在 <a href=\"https://github.com/nacos-group/nacos-plugin\">nacos-plugin</a> 仓库。</p>\n<p>在 Nacos 服务端启动的时候就会加载所有依赖的加解密算法，然后通过发布配置的 <code>dataId</code> 的前缀来进行匹配是否需要加解密和使用的加解密算法。</p>\n<p>客户端发布的配置会在客户端通过filter完成加解密，也就是配置在传输过程中都是密文的。而控制台发布的配置会在服务端进行处理。</p>\n<h1>如何使用</h1>\n<p>Nacos 加解密插件是可插拔的，有没有都不影响 Nacos 的核心功能的运行。如果想要使用 Naocs 的配置加解密功能需要单独引用加密算法的实现。客户端和服务端都通过添加以下依赖来使用 AES 加解密算法，服务端推荐添加到 config 模块下。</p>\n<pre><code>        &lt;dependency&gt;\n            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;\n            &lt;artifactId&gt;nacos-aes-encryption-plugin&lt;/artifactId&gt;\n            &lt;version&gt;${nacos-aes-encryption-plugin.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<p>${nacos-aes-encryption-plugin.version} 可以获取插件的最新版本。</p>\n<h1>创建加密配置</h1>\n<ul>\n<li>\n<p>打开 Nacos 控制台，点击新建配置。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24ely1h0cxaklw10j21g20u0ac8.jpg\" alt=\"\"></p>\n</li>\n<li>\n<p>配置前缀使用cipher-[加密算法名称]-dataId来标识这个配置需要加密，系统会自动识别并加密。例如使用 AES 算法来解密配置：cipher-aes-application-dev.yml。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24ely1h0cxs40s2tj21b40u0whw.jpg\" alt=\"\"></p>\n</li>\n<li>\n<p>点击保存,查看数据库</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/e6c9d24ely1h0cxwhdc77j21xm0bumz2.jpg\" alt=\"\"></p>\n</li>\n</ul>\n",
  "title": "配置加密",
  "keywords": "AES,encryption,配置加密",
  "description": "配置加密"
}