<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="Nacos,FAQ" />
	<meta name="description" content="Nacos FAQ" />
  <meta name="baidu-site-verification" content="code-wzq5sw7io3" />
	<!-- 网页标签标题 -->
	<title>FAQ</title>
	<link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/nacos_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><span><a href="/zh-cn/index.html">首页</a></span></li><li class="menu-item menu-item-normal menu-item-normal-active"><div class="nav-container"><div class="word"><a>文档</a></div><ul class="sub-nav-container" style="width:220px"><li><a href="/zh-cn/docs/v2/quickstart/quick-start.html" target="_blank">2.X</a></li><li><a href="/zh-cn/docs/quick-start.html" target="_blank">1.X（过期）</a></li></ul> </div></li><li class="menu-item menu-item-normal"><div class="nav-container"><div class="word"><a>解决方案</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png"/></div><ul class="sub-nav-container" style="width:220px"><li><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target="_blank">微服务解决方案</a></li><li><a href="https://cn.aliyun.com/product/aliware/sae?spm=nacos-website.topbar.0.0.0" target="_blank">微服务Serverless解决方案</a></li><li><a href="https://www.aliyun.com/product/edas?spm=nacos-website.topbar.0.0.0" target="_blank">PaaS解决方案</a></li></ul> </div></li><li class="menu-item menu-item-normal"><span><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0">企业版NACOS</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png"/></span></li><li class="menu-item menu-item-normal"><span><a href="https://developer.aliyun.com/ebook/36?spm=a2c6h.20345107.ebook-index.18.152c2984fsi5ST">NACOS架构与原理</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png"/></span></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/blog/index.html">博客</a></span></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/community/index.html">社区</a></span></li><li class="menu-item menu-item-normal"><span><a href="http://console.nacos.io/nacos/index.html">控制台样例</a></span></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/docs.png" class="front-img"/><div class="bar-title"><span>Nacos 文档</span><div class="bone bone-light"></div></div><img src="/img/docs.png" class="back-img"/></div></div><section class="content-section"><div class="content-body"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>Nacos </span><ul><li style="height:180px;overflow:hidden" class="menu-item menu-item-level-2"><span>Nacos是什么?<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/what-is-nacos.html" target="_self">Nacos简介</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/concepts.html" target="_self">概念</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/architecture.html" target="_self">架构</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/feature-list.html" target="_self">功能和需求列表</a></li></ul></li><li style="height:180px;overflow:hidden" class="menu-item menu-item-level-2"><span>Nacos 2.0<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.0.0-compatibility.html" target="_self">兼容性及使用</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/2.0.0-upgrading.html" target="_self">升级文档</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/auth-plugin.html" target="_self">鉴权插件</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/config-encryption.html" target="_self">配置加密插件</a></li></ul></li><li style="height:324px;overflow:hidden" class="menu-item menu-item-level-2"><span>快速开始<img style="transform:rotate(0deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start.html" target="_self">Nacos</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start-spring.html" target="_self">Nacos Spring</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start-spring-boot.html" target="_self">Nacos Spring Boot</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start-spring-cloud.html" target="_self">Nacos Spring Cloud</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start-docker.html" target="_self">Nacos Docker</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/use-nacos-with-dubbo.html" target="_self">Nacos Dubbo</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/use-nacos-with-kubernetes.html" target="_self">Nacos k8s</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nacos-sync.html" target="_self">Nacos Sync</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>用户指南<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/sdk.html" target="_self">Java的SDK</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/other-language.html" target="_self">其他语言的SDK</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/open-api.html" target="_self">Open-API指南</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nacos-spring.html" target="_self">Nacos Spring</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/system-configurations.html" target="_self">Nacos系统参数介绍</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/auth.html" target="_self">权限认证</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/faq.html" target="_self">FAQ</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>运维指南<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/deployment.html" target="_self">部署手册</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/cluster-mode-quick-start.html" target="_self">集群部署说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/management-api.html" target="_self">运维API</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/console-guide.html" target="_self">控制台手册</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/monitor-guide.html" target="_self">监控手册</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nacos-config-benchmark.html" target="_self">Nacos配置模块压测报告</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nacos2-config-benchmark.html" target="_self">Nacos2.0配置模块压测报告</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nacos-naming-benchmark.html" target="_self">Nacos服务发现模块压测报告</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nacos2-naming-benchmark.html" target="_self">Nacos2.0服务发现模块压测报告</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nacos-sync-use.html" target="_self">其他环境迁移到Nacos</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>开源共建<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/contributing.html" target="_self">贡献源码</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/contributing-flow.html" target="_self">贡献流程</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/pull-request.html" target="_self">pull request模板</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/how-to-reporting-bugs.html" target="_self">如何提交问题报告</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>社区<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/community.html" target="_self">社区</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/nacos-dev.html" target="_self">开发团队</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>FAQ</h1>
<ul>
<li>
<p>Nacos常规问题</p>
<ul>
<li><a href="#1.1">Nacos是什么</a></li>
<li><a href="#1.2">Nacos如何支持多环境</a></li>
<li><a href="#1.3">Nacos是否生产可用</a></li>
<li><a href="#1.4">Nacos版本计划</a></li>
<li><a href="#1.5">Nacos有什么依赖</a></li>
<li><a href="#1.6">Nacos使用什么开源协议</a></li>
</ul>
</li>
<li>
<p>Nacos运维问题</p>
<ul>
<li><a href="#2.1">Nacos如何单机部署</a></li>
<li><a href="#2.2">Nacos单机部署如何使用Mysql</a></li>
<li><a href="#2.3">生产环境如何部署Nacos</a></li>
<li><a href="#2.4">Nacos如何Docker部署</a></li>
<li><a href="#2.5">如何在k8s中部署Nacos</a></li>
<li><a href="#2.6">如何监控Nacos</a></li>
<li><a href="#2.7">Nacos在Docker环境下集群部署，无法正常启动，日志一直打印 Nacos is starting...</a></li>
</ul>
</li>
<li>
<p>Nacos使用问题</p>
<ul>
<li><a href="#3.1">Zookeeper服务可以迁移到Nacos上吗</a></li>
<li><a href="#3.2">Nacos支持多配置文件</a></li>
<li><a href="#3.3">Nacos支持Dubbo</a></li>
<li><a href="#3.4">Nacos支持Spring体系</a></li>
<li><a href="#3.5">不使用Nacos SDK如何访问Nacos</a></li>
<li><a href="#3.6">Nacos对多语言的支持</a></li>
<li><a href="#3.7">Nacos0.8版本登陆失败</a></li>
<li><a href="#3.8">服务端报错<code>java.lang.IllegalStateException: unable to find local peer: 127.0.0.1:8848</code></a></li>
<li><a href="#3.9">Nacos如何对配置进行加密</a></li>
<li><a href="#3.10">Nacos报401错误</a></li>
<li><a href="#3.11">Nacos权重不生效</a></li>
<li><a href="#3.12">Nacos如何扩缩容</a></li>
<li><a href="#3.13">Nacos客户端修改日志级别</a></li>
<li><a href="#3.14">Nacos与Zipkin 整合出现<code>Service not found</code>问题</a></li>
<li><a href="#3.15">如何依赖最新的Nacos客户端？</a></li>
<li><a href="#3.16">客户端CPU高，或者内存耗尽的问题</a></li>
<li><a href="#3.17">日志打印频繁的问题</a></li>
<li><a href="#3.18">集群管理页面，raft term显示不一致问题</a></li>
<li><a href="#3.19">找不到符号<code>com.alibaba.nacos.consistency.entity</code></a></li>
</ul>
</li>
<li>
<p>Nacos原理问题</p>
</li>
</ul>
<h2>Nacos常规问题</h2>
<h4 id="1.1">Nacos是什么</h4>
<p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。详情可以参考<a href="https://nacos.io/zh-cn/docs/what-is-nacos.html">Nacos官网介绍</a>。</p>
<h4 id="1.2">Nacos如何支持多环境</h4>
<p>在日常使用中常常需要不同的环境，比如日常，预发，线上环境，如果是逻辑隔离可以使用命名空间，Nacos支持命名空间来支持多环境隔离，可以在Nacos控制台创建多个命名空间。如果需要物理隔离，就要部署多套Nacos环境。</p>
<h4 id="1.3">Nacos是否生产可用</h4>
<p>Nacos在2019.1发布了Pre-GA版本，支持了安全隔离、监控和服务迁移等上生产的最后一公里，以更稳定的支撑用户的生产环境。详情可以参考<a href="https://www.oschina.net/news/104019/nacos-0-8-0-pre-ga">Nacos 发布 v0.8.0 Pre-GA 版本，安全稳定上生产</a>。</p>
<h4 id="1.4">Nacos版本计划</h4>
<p>Nacos 0.8.0 开始支持生产可用，1.0版本达到大规模生产可用，2.0版本计划与K8s、Spring Cloud、Service Mesh、Serverless进一步融合，具体的详情参考<a href="https://nacos.io/zh-cn/docs/roadmap.html">Nacos规划</a>。</p>
<h4 id="1.5">Nacos有什么依赖</h4>
<p>在单机模式下，Nacos没有任何依赖，在集群模式下，Nacos依赖Mysql做存储，详情可以参考<a href="https://nacos.io/zh-cn/docs/deployment.html">Nacos部署</a>。</p>
<h4 id="1.6">Nacos使用什么开源协议</h4>
<p>Nacos使用<a href="https://github.com/alibaba/nacos/blob/master/LICENSE">Apache 2.0</a>。</p>
<h2>Nacos运维问题</h2>
<h4 id="2.1">Nacos如何单机部署</h4>
<p>可以参考Nacos官网部署手册<a href="https://nacos.io/zh-cn/docs/quick-start.html">quick start</a>。</p>
<h4 id="2.2">Nacos单机部署如何使用mysql</h4>
<p>Nacos单机模式默认使用内嵌的数据库作为存储引擎，如果想换成自己安装的mysql，可以按照<a href="https://nacos.io/zh-cn/docs/deployment.html">官网文档</a>。</p>
<h4 id="2.3">生产环境如何部署Nacos</h4>
<p>生产环境使用Nacos为了达到高可用不能使用单机模式，需要搭建nacos集群，具体详情可以参考<a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html">集群部署手册</a>。</p>
<h4 id="2.4">Nacos如何Docker部署</h4>
<p>除了使用压缩包部署Nacos，Nacos也提供了相应的Docker镜像，当Nacos发布新的版本的时候，Nacos会发布对应的镜像版本支持Docker部署。具体详情可以参考<a href="https://nacos.io/zh-cn/docs/quick-start-docker.html">Nacos Docker</a>。</p>
<h4 id="2.5">如何在k8s中部署Nacos</h4>
<p>在生产环境部署Nacos集群，如果要对Nacos进行扩容操作，需要手动更改集群ip文件，启动新的Nacos服务。为了能进行自动化运维，Nacos和k8s结合利用StatefulSets提供了自动运维方案，能对Nacos进行动态扩缩容，具体详情参考<a href="https://github.com/nacos-group/nacos-k8s/blob/master/README-CN.md">Kubernetes Nacos</a>。</p>
<h4 id="2.6">如何监控Nacos</h4>
<p>Nacos0.8版本提供了Metrics数据暴露能力，能通过Metrics数据的内容对Nacos的运行状态进行监控，详情参考<a href="https://nacos.io/zh-cn/docs/monitor-guide.html">Nacos监控</a>。</p>
<h4 id="2.7">Nacos在Docker环境下集群部署，无法正常启动，日志一直打印 Nacos is starting...</h4>
<p>原因可能是由于Docker环境下，内存不足导致另外的服务无法正常启动，最后导致服务报错，一直重启，可以通过增大Docker限制内存尝试解决。</p>
<h2>Nacos使用问题</h2>
<h4 id="3.1">Zookeeper上的服务可以迁移到Nacos上吗</h4>
<p>可以通过Nacos-Sync把Zookeeper服务迁移到Nacos，也可以从Nacos迁移到Zookeeper，具体可以参考<a href="https://github.com/paderlol/nacos-sync-example">Nacos Sync 使用</a>。</p>
<h4 id="3.2">Nacos支持多配置文件</h4>
<p>Nacos通过Spring Cloud Alibaba Nacos Config支持了多配置文件，可以将配置存储在多个独立的配置文件中。关联的<a href="https://github.com/alibaba/nacos/issues/320">issue</a>，详情参考文档<a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba/wiki/Nacos-config">Spring Cloud Alibaba Nacos Config</a>。</p>
<h4 id="3.3">Nacos支持Dubbo</h4>
<p>Nacos 0.6版本和Dubbo集成，支持使用Nacos作为注册中心，关联<a href="https://github.com/alibaba/nacos/issues/390">issue</a>,具体文档参考<a href="https://nacos.io/zh-cn/docs/use-nacos-with-dubbo.html">Dubbo 融合 Nacos 成为注册中心</a>。</p>
<h4 id="3.4">Nacos支持Spring体系</h4>
<p>Nacos完善支持了Sping技术栈，具体可以参考<a href="https://nacos.io/zh-cn/docs/quick-start-spring.html">Nacos Spring</a>、<a href="https://nacos.io/zh-cn/docs/quick-start-spring-boot.html">Nacos Spring Boot</a>、<a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html">Spring Cloud</a>。</p>
<h4 id="3.5">不使用Nacos SDK如何访问Nacos</h4>
<p>Nacos的网络交互都是基于Http协议实现的，提供了<a href="https://nacos.io/zh-cn/docs/open-api.html">Open-API</a>可以很容易实现Nacos的访问。</p>
<h4 id="3.6">Nacos对多语言的支持</h4>
<p>Nacos目前只支持Java，对于其他语言的支持还正在开发中，需要大家大力支持一起共建。</p>
<h4 id="3.7">Nacos0.8版本登陆失败</h4>
<p>Nacos 0.8版本当使用openjdk并且没有<code>JAVA_HOME</code>的环境变量时，nacos可以启动成功，是因为<code>yum install</code>安装的openjdk 会把java命令注册一份到<code>/bin</code>目录下面,所以会引发<code>SignatureException</code>异常。这个问题已经修复，0.9版本会发版，具体详情可以参考<a href="https://github.com/alibaba/nacos/issues/711">issue</a>。</p>
<h4 id="3.8">服务端报错 java.lang.IllegalStateException: unable to find local peer: 127.0.0.1:8848</h4>
<p>这个问题是因为Nacos获取本机IP时,没有获取到正确的外部IP.需要保证<code>InetAddress.getLocalHost().getHostAddress()</code>或者<code>hostname -i</code>的结果是与cluster.conf里配置的IP是一致的。</p>
<h4 id="3.9">Nacos如何对配置进行加密</h4>
<p>Nacos计划在1.X版本提供加密的能力，目前还不支持加密，只能靠sdk做好了加密再存到nacos中。</p>
<h4 id="3.10">Nacos报401错误</h4>
<p>Nacos服务端报错了，可以检查服务端日志，参考<a href="https://github.com/alibaba/nacos/issues/816">issue</a>。</p>
<h4 id="3.11">Nacos权重不生效</h4>
<p>Nacos控制台上编辑权重, 目前从SpringCloud客户端和Dubbo客户端都没有打通, 所以不能生效. 对于SpringCloud客户端, 应用可以实现Ribbon的负载均衡器来进行权重过滤。</p>
<h4 id="3.12">Nacos如何扩缩容</h4>
<p>目前支持修改cluster.conf文件的方式进行扩缩容, 改完后无需重启, Server会自动刷新到文件新内容。</p>
<h4 id="3.13">Nacos客户端修改日志级别</h4>
<p>配置-D参数com.alibaba.nacos.naming.log.level设置naming客户端的日志级别，例如设置为error：
<code>-Dcom.alibaba.nacos.naming.log.level=error</code>
同样的，-D参数com.alibaba.nacos.config.log.level用来设置config客户端的日志级别。</p>
<h4 id="3.14">Nacos与Zipkin 整合出现 Service not found 问题</h4>
<p>配置<code>spring-cloud-seluth</code>参数：<code>spring.zipkin.discovery-client-enabled=false</code>。</p>
<p>如果仍然存在<code>Service not found</code>错误，则建议先使用open-api将Zipkin-server注册为永久实例服务：</p>
<p><code>curl -X POST 'http://127.0.0.1:8848/nacos/v1/ns/instance?port=9411&amp;healthy=true&amp;ip=127.0.0.1&amp;weight=1.0&amp;serviceName=zipkin-server&amp;ephemeral=false&amp;namespaceId=public'</code></p>
<p>然后，前往nacos控制台，找到服务名为<code>zipkin-server</code>的服务，找到集群配置，设置健康检查模式为<code>TCP</code>，端口号为<code>9411</code>(即zipkin-server的端口)。</p>
<h4 id="3.15">如何依赖最新的Nacos客户端？</h4>
很多用户都是通过Spring Cloud Alibaba或者Dubbo依赖的Nacos客户端，那么Spring Cloud Alibaba和Dubbo中依赖的Nacos客户端版本，往往会落后于Nacos最新发布的版本。在一些情况下，用户需要强制将Nacos客户端升级到最新，此时却往往不知道该升级哪个依赖，这里将Spring Cloud Alibaba和Dubbo的依赖升级说明如下：
<h5>Spring Cloud Alibaba</h5>
<p>用户通常是配置以下Maven依赖来使用的Nacos：</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!--Nacos Discovery--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[latest version]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!--Nacos Config--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[latest version]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>这两个jar包实际上又依赖了以下的jar包：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.nacos<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>nacos-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[a particular version]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>如果nacos-client升级了，对应的spring-cloud客户端版本不一定也同步升级，这个时候可以采用如下的方式强制升级nacos-client（以nacos-discovery为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[latest version]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>
                 <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.nacos<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                 <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>nacos-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.nacos<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>nacos-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[latest version]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h5>Dubbo</h5>
<p>Dubbo也是类似的道理，用户通常引入的是以下的依赖：</p>
<pre><code class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo-registry-nacos<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[latest version]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>   
    
    <span class="hljs-comment">&lt;!-- Dubbo dependency --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[latest version]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>需要升级Nacos客户端时，只需要如下修改依赖：</p>
<pre><code class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.nacos<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>nacos-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[latest version]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 id="3.16">客户端CPU高，或者内存耗尽的问题</h4>
问题的现象是依赖Nacos客户端的应用，在运行一段时间后出现CPU占用率高，内存占用高甚至内存溢出的现象，可以参考issue：[https://github.com/alibaba/nacos/issues/1605](https://github.com/alibaba/nacos/issues/1605)。这种情况首先要做的是分析CPU高或者内存占用高的原因，常用的命令有top、jstack、jmap、jhat等。其中一种情况是Nacos客户端实例在Spring Cloud Alibaba服务框架中被反复构造了多次，可以参考issue：[https://github.com/alibaba/spring-cloud-alibaba/issues/859](https://github.com/alibaba/spring-cloud-alibaba/issues/859)。这个问题已经得到了修复，预期会在下个Spring Cloud Alibaba版本中发布。
<h4 id="3.17">日志打印频繁的问题</h4>
在老的Nacos版本中，往往会有大量的无效日志打印，这些日志的打印会迅速占用完用户的磁盘空间，同时也让有效日志难以查找。目前社区反馈的日志频繁打印主要有以下几种情况：
<ol>
<li>access日志大量打印，相关issue有：<a href="https://github.com/alibaba/nacos/issues/1510">https://github.com/alibaba/nacos/issues/1510</a>。主要表现是{nacos.home}/logs/access_log.2019-xx-xx.log类似格式文件名的日志大量打印，而且还不能自动清理和滚动。这个日志是Spring Boot提供的tomcat访问日志打印，Spring Boot在关于该日志的选项中，没有最大保留天数或者日志大小控制的选项。因此这个日志的清理必须由应用新建crontab任务来完成，或者通过以下命令关闭日志的输出（在生产环境我们还是建议开启该日志，以便能够有第一现场的访问记录）：</li>
</ol>
<pre><code>server.tomcat.accesslog.enabled=false
</code></pre>
<ol start="2">
<li>服务端业务日志大量打印且无法动态调整日志级别。这个问题在1.1.3已经得到优化，可以通过API的方式来进行日志级别的调整，调整日志级别的方式如下：</li>
</ol>
<pre><code># 调整naming模块的naming-raft.log的级别为error:
curl -X PUT '$nacos_server:8848/nacos/v1/ns/operator/log?logName=naming-raft&amp;logLevel=error'
# 调整config模块的config-dump.log的级别为warn:
curl -X PUT '$nacos_server:8848/nacos/v1/cs/ops/log?logName=config-dump&amp;logLevel=warn'
</code></pre>
<ol start="3">
<li>客户端日志大量打印，主要有心跳日志、轮询日志等。这个问题已经在1.1.3解决，请升级到1.1.3版本。</li>
</ol>
<h4 id="3.18">集群管理页面，raft term显示不一致问题</h4>
在Nacos 1.0.1版本中，Nacos控制台支持了显示当前的集群各个机器的状态信息。这个功能受到比较多用户的关注，其中一个被反馈的问题是列表中每个节点的集群任期不一样。如下图所示（图片信息来自issue：https://github.com/alibaba/nacos/issues/1786）：
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/333810/1567737322959-eed80457-e74c-4adb-bc29-6655860f8ca9.png#align=left&amp;display=inline&amp;height=279&amp;name=image.png&amp;originHeight=558&amp;originWidth=1685&amp;size=45557&amp;status=done&amp;width=842.5" alt="image.png"></p>
<p>对于这个任期不一致的问题，原因主要是因为获取这个信息的逻辑有一些问题，没有从对应的节点上获取集群任期。这个问题会在下一个Nacos版本中修复。目前一个手动检查集群任期的办法是在每个节点上执行以下命令：</p>
<pre><code>curl '127.0.0.1:8848/nacos/v1/ns/raft/state'
</code></pre>
<p>然后在返回信息中查找本节点的集群任期。因为每个节点返回的集群任期中，只有当前节点的信息是准确的，返回的其他节点的信息都是不准确的。</p>
<h4 id="3.19">找不到符号`com.alibaba.nacos.consistency.entity`</h4>
<p>这个包目录是由<code>protobuf</code>在编译时自动生成，您可以通过<code>mvn compile</code>来自动生成他们。如果您使用的是IDEA，也可以使用IDEA的protobuf插件。</p>
<h2>Nacos原理问题</h2>
</div></div></section><footer class="footer-container"><div class="footer-body"><img src="/img/nacos_gray.png"/><div class="cols-container"><div class="col col-12"><h3>愿景</h3><p>Nacos 通过提供简单易用的动态服务发现、服务配置、服务共享与管理等服务基础设施，帮助用户在云原生时代，在私有云、混合云或者公有云等所有云环境中，更好的构建、交付、管理自己的微服务平台，更快的复用和组合业务服务，更快的交付商业创新的价值，从而为用户赢得市场。</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/what-is-nacos.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/contributing.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd><dd><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target="_self">云服务 MSE</a></dd><dd><a href="https://www.aliyun.com/product/edas?source_type=nacos_pc_20181219" target="_self">云服务 EDAS</a></dd><dd><a href="https://www.aliyun.com/product/ahas?source_type=nacos_pc_20190225" target="_self">云服务 AHAS</a></dd></dl></div></div><div class="copyright"><span>@ 2022 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js">
	</script>
	<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e3a5cec56ef8619cf9d7c2abebd509e3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
</body>
</html>